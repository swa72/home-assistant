- id: '1608063965030'
  alias: q3 Wenn neue Version dann Nachricht an Stefan
  trigger:
  - platform: state
    entity_id: binary_sensor.updater
    from: 'off'
    to: 'on'
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version')
        }} is now available.
  mode: single
- id: '1608636183988'
  alias: q3 Notify, wenn Fenster zu lange offen und kalt draussen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:10:00
    to: 'on'
    entity_id: group.dachfenster
  - platform: state
    entity_id: group.ogfenster
    from: 'off'
    for: 00:10:00
    to: 'on'
  - platform: state
    entity_id: group.egfenster
    from: 'off'
    to: 'on'
    for: 00:10:00
  condition:
  - condition: numeric_state
    entity_id: weather.home
    value_template: '{{ state.attributes.temperature }}'
    below: '15'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: '{% set w = expand( trigger.entity_id ) | selectattr(''state'', ''eq'',
        ''on'') | map(attribute=''name'') | list %} Fenster {{ w }} aus Gruppe {{
        trigger.to_state.attributes.friendly_name }} ist zu lange ({{trigger.for}}
        min) offen. Temperatur unter 15°C.'
  mode: single
- id: l1k3
  alias: q3 Wenn Mitternacht, push HA configuration to GitHub repo
  trigger:
  - at: '23:23'
    platform: time
  action:
  - service: shell_command.push_to_github
  mode: single
- id: '1609858165994'
  alias: q3 Windfanglicht bei Dunkelheit
  description: Windfanglicht an, wenn dunkel draußen; aus, wenn es hell wird
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'off'
    to: 'on'
    id: an
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    id: aus
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.licht_windfang
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.licht_windfang
    default: []
  mode: single
- id: '1609924669215'
  alias: q3 Wenn Volvo zuhause und lönger als 15min offen dann abschließen
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.volvo_zuhause_und_offen
    to: 'on'
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 15
      milliseconds: 0
  - service: lock.lock
    data: {}
    entity_id: lock.su_xp1654_door_lock
  mode: single
- id: '1611480761802'
  alias: q3 Wenn Garage geöffnet wird und dunkel draußen, dann Flur-EG Licht an und
    LED-Fluter an
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.garagentur
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: d824de0a6c667da98e0f508d5d4129e5
    entity_id: switch.eg_flur_licht
    domain: switch
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  mode: single
- id: '1611495931370'
  alias: q3 Wenn Kellerpumpe Treppe anläuft, dann Zähler erhöhen
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_keller_pumpe_treppe_power
    above: '5'
    for: 00:00:03
  condition: []
  action:
  - service: counter.increment
    data: {}
    entity_id: counter.kellerpumpe
  mode: single
- id: '1611496375383'
  alias: q3 Wenn Mitternacht, dann Zähler zurücksetzen
  description: ''
  trigger:
  - platform: time
    at: 00:00
  condition: []
  action:
  - service: counter.reset
    data: {}
    target:
      entity_id:
      - counter.kellerpumpe
  mode: single
- id: '1611515523821'
  alias: q3 zAlexa Media Player TTS/Announce from Lovelace UI
  description: ''
  use_blueprint:
    path: NachtaktiverHalbaffe/alexa-tts-announcement-from-lovelace-ui-and-without-nabu-casa-alexa-media-player.yaml
    input:
      message: input_text.swa_alexa_text
      target: input_select.swa_alexa_device
- id: '1612096410696'
  alias: q3 Notify, wenn Waschmaschine fertig
  description: Waschmaschine fertig
  use_blueprint:
    path: Sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      finishing_hysteresis: 5
      power_sensor: sensor.shellys_wama_power
      starting_threshold: '100'
      starting_hysteresis: '3'
      finishing_threshold: '40'
      actions:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Waschmaschine ist fertig seit {{ now().hour }}:{{ now().minute
            }}.
      - service: script.turn_on
        data: {}
        entity_id: script.alexa_wama_fertig
- id: '1612602466906'
  alias: q3 Notify, wenn Katzentuer abends geschlossen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:05:00
    to: 'on'
    entity_id: binary_sensor.abend_eg_wohnzimmer_tuer_zu
  condition: []
  action:
  - service: script.alexa_doorbell
    data: {}
    entity_id: script.alexa_doorbell
  - service: script.alexa_tts_katzentur_offnen
    data: {}
    entity_id: script.alexa_tts_katzentur_offnen
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Die Wohnzimmertür für die Katzen offen lassen.
  mode: single
- id: '1612604258681'
  alias: q3 Notify, wenn  2000 Uhr und Volvo hat zu wenig Benzin
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: template
    value_template: '{{ states(''sensor.su_xp1654_fuel_amount'') | float < 10 }}'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Der Volvo hat nur noch {{ states('sensor.su_xp1654_fuel_amount') }}l
        Benzin.
  mode: single
- id: '1612709996219'
  alias: q3 Notify, wenn Garage zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:30:00
    id: garage1
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:45:00
    id: garage2
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: garage1
        - condition: trigger
          id: garage2
      sequence:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Garagentor ist (zu lange) offen
    default: []
  mode: single
- id: '1612710199273'
  alias: q3 Notify, wenn Haustür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    to: 'on'
    for: 00:10:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Haustür ist (zu lange) offen. Es hat {{ state_attr('weather.home',
        'temperature') }} Grad draußen."
  mode: single
- id: '1612710265420'
  alias: q3 Notify, wenn Kellertür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.kellertur
    to: 'on'
    for: 00:30:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Kellertür ist (zu lange) offen. Es hat {{ state_attr('weather.home',
        'temperature') }} Grad draußen."
  mode: single
- id: '1612710429192'
  alias: q3 Urgent Notify, wenn Freezer im Büro zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:02:00
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:04:00
  condition: []
  action:
  - service: script.urgent_notify_people_who_are_present
    data:
      title: Hinweis
      message: Freezer im Büro ist (zu lange) offen.
  mode: single
- id: '1616954536097'
  alias: q3 Notify parents, wenn Luftfeuchtigkeit zu hoch
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_schlaf'') == ''on'' and
      states(''sensor.dew_og_schlaf_open_window'') }}'
    id: schlafzimmer
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_elternbad'') == ''on''
      and states(''sensor.dew_og_elternbad_open_window'') }}'
    id: elternbad
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_konstantin'')== ''on''
      and states(''sensor.dew_og_konstantin_open_window'') }}'
    id: konstantin
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_clara'') == ''on'' and
      states(''sensor.dew_og_clara_open_window'') }}'
    id: clara
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_eg_buro'') == ''on'' and states(''sensor.dew_eg_buro_open_window'')
      }}'
    id: Büro EG
  condition: []
  action:
  - service: script.notify_parents
    data:
      title: Hinweis
      message: '{{ trigger.to_state.attributes.friendly_name }} Bitte Fenster öffnen.'
  mode: queued
  max: 10
- id: '1620553045155'
  alias: q3 Wenn zu warm im DG oder 0900 Uhr und Stefan im Office, frage Stefan ob
    AC angestellt werden soll
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.stefan_working_in_office
    to: 'on'
  - platform: time
    at: 09:00:00
  condition:
  - condition: template
    value_template: '{{states("sensor.multi_dg_stefan_temperature") | float >= 23}}'
  - condition: state
    entity_id: binary_sensor.stefan_working_in_office
    state: 'on'
  - condition: template
    value_template: '{{ is_state(''automation.notify_stefan_zu_heiss_in_dg'', ''off'')  }}'
  action:
  - alias: q1 Set up variables for the actions
    variables:
      action_on: '{{ ''ON_'' ~ context.id }}'
      action_nothing: '{{ ''NOTHING_'' ~ context.id }}'
  - alias: q1 Ask a question
    service: notify.mobile_app_iphonebwi12bwi12
    data:
      message: Temp too hot in office. Turn on AC?
      data:
        actions:
        - action: '{{ action_on }}'
          title: 'On'
        - action: '{{ action_nothing }}'
          title: No thanks
  - alias: q1 Wait for a response
    wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_on }}'
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_nothing }}'
  - alias: q1 Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_on}}'
      sequence:
      - service: script.turn_on_ac_at_stefans_office
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_nothing }}'
      sequence:
  mode: single
  max: 10
- id: '1623348230796'
  alias: q3 Wenn Nacht, dann lasse Pool Pumpe laufen
  description: ''
  trigger:
  - platform: time
    at: '23:00'
  condition: []
  action:
  - type: turn_on
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  - delay:
      hours: 5
      minutes: 0
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  mode: single
- id: '1626027211313'
  alias: 'q3 Notify Stefan, wenn major shelly und esp devices nicht verfügbar sind '
  description: ''
  use_blueprint:
    path: bfranke1973/device_connectivity_notification.yaml
    input:
      message: ' Hint: network connection lost for devices: {{ disconnected_servers
        }} '
      notify_device: 433037e716d3d27ae2dd99df7a9818b0
      server_group: group.servers
- id: '1631904142960'
  alias: Advanced Heating Monitor_
  description: Sends message to Stefan if heating shows non-regular codes,  checks
    pressure, sets NTP time at night
  trigger:
  - platform: state
    entity_id: sensor.boiler_service_code
    to: 6A
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    id: servicecode
  - platform: time
    at: 00:01
    id: setntp
  - platform: numeric_state
    entity_id: sensor.boiler_system_pressure
    below: '1.9'
    id: heizungsdruck
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: servicecode
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating
          message: 'Service Code: {{ states(''sensor.boiler_service_code'') }} Service
            Code Number: {{ states(''sensor.boiler_service_code_number'') }}'
    - conditions:
      - condition: trigger
        id: setntp
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"datetime","data":"ntp"}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: heizungsdruck
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating
          message: Heizungsdruck über 1h unter 1.9 bar.
  mode: single
- id: '1632288672635'
  alias: q3 Notify, if basement dehumidifier is full
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.entfeuchter_voll
    to: 'True'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    id: entfeuchtervoll
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: entfeuchtervoll
      sequence:
      - service: script.notify_parents
        data: {}
      - service: script.alexa_tts_entfeuchter_voll
        data: {}
    default: []
  mode: single
- id: '1632424762898'
  alias: Advanced Rolladen Schlafzimmer
  description: Rolladensteuerung Schlafzimmer zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: time
    at: input_datetime.cover_morning_weekday
    id: wochentags
  - platform: time
    at: input_datetime.cover_morning_holiday
    id: wochentagsferien
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '21:00'
    id: abends2
  - platform: time
    at: input_datetime.cover_morning_weekend
    id: wochenende
  - platform: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    id: warmesschlafzimmer
    above: '24'
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - platform: homeassistant
    event: start
    id: hastart
  - platform: event
    event_type:
    - automation_reloaded
    id: automation_reloaded
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - scene: scene.schlafzimmer_abend_sommer
    - conditions:
      - condition: trigger
        id: wochentags
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: calendar.ferien
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.multi_og_schlaf_temperature
        below: '24'
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: wochentagsferien
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: calendar.ferien
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.multi_og_schlaf_temperature
        below: '24'
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: wochenende
      - condition: time
        weekday:
        - sat
        - sun
      - condition: numeric_state
        entity_id: sensor.multi_og_schlaf_temperature
        below: '24'
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: warmesschlafzimmer
        - condition: trigger
          id: hastart
        - condition: trigger
          id: automation_reloaded
      - condition: numeric_state
        entity_id: sensor.multi_og_schlaf_temperature
        above: '24'
      - condition: time
        after: input_datetime.cover_morning_holiday
        before: '21:00:00'
      - condition: numeric_state
        entity_id: sensor.boiler_outside_temperature
        above: '10'
      sequence:
      - service: cover.set_cover_position
        target:
          area_id:
          - og_schlaf
          - og_elternbad
        data:
          position: 40
    default: []
  mode: queued
  max: 10
- id: '1632469853125'
  alias: Advanced Rolladen Anna
  description: Temperatur-abhängiges Schliessen
  trigger:
  - platform: numeric_state
    entity_id: sensor.multi_dg_anna_temperature
    above: '23'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - platform: time
    at: '10:01'
  condition:
  - condition: time
    after: '10:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: numeric_state
    entity_id: sensor.multi_dg_anna_temperature
    above: '22'
  action:
  - service: cover.close_cover
    target:
      entity_id: cover.shelly25_dg_anna_rolladen
    data: {}
  mode: single
- id: '1632543105220'
  alias: Power Save bei Waschmaschine
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_wama_power
    below: '4'
    above: '0'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch an.
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: numeric_state
    entity_id: sensor.shellys_wama_power
    above: '0'
    below: '4'
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch immer an.
  mode: single
- id: '1632671280558'
  alias: Advanced Monitor Stefan
  description: ''
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: heat_cool
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: cool
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.fenster_sw
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
    - condition: state
      entity_id: binary_sensor.fenster_o
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: Klimaanlage im DG läuft noch.
  mode: single
- id: '1633366928831'
  alias: Fake test automation
  description: ''
  trigger:
  - platform: time
    at: '19:02'
    id: swatrigger
  condition: []
  action:
  - service: script.notify_stefan_heating
    data:
      title: automation.fake_test_automation
      message: foo bar {{ trigger.id }} {{ trigger.platform }}
  - service: logbook.log
    data:
      entity_id: automation.fake_test_automation
      message: some message
      name: automation.fake_test_automation
  mode: single
- id: '1634980794843'
  alias: Advanced Heating Forecast v2
  description: Set offset temp if next day is too warm/sunny with check
  trigger:
  - platform: time
    at: '23:30'
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.heating_forecast_condition
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].condition }}'
  - service: input_number.set_value
    target:
      entity_id: input_number.heating_forecast_temperature
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].temperature | float
        }}'
  - condition: state
    entity_id: sensor.heating_warmnextday
    state: warm
  - service: logbook.log
    data:
      message: Tomorrow will be warm ({{states('input_text.heating_forecast_condition')}}/     {{states('input_number.heating_forecast_temperature')}}).
        All offsets -3. If temp at night below 17, heating will likely still be off.
      name: automation.advanced_heating_forecast_v2
      entity_id: automation.advanced_heating_forecast_v2
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 1
      offset: -3
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 2
      offset: -3
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 3
      offset: -3
  mode: single
- id: '1634985348876'
  alias: Advanced Heating workdays v2
  description: Set temp low during Julia's workdays, skip holidays
  trigger:
  - platform: time
    at: 07:00
    id: morning
  - platform: time
    id: noon
    at: '12:00'
  condition:
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning
      - condition: time
        weekday:
        - mon
        - thu
        - fri
      sequence:
      - service: script.heating_set_room_temp_low
      - service: logbook.log
        data:
          entity_id: automation.advanced_heating_workdays_v2
          name: automation.advanced_heating_workdays_v2
          message: Started script.heating_set_room_temp_low
    - conditions:
      - condition: trigger
        id: noon
      - condition: time
        weekday:
        - mon
        - thu
        - fri
      sequence:
      - service: script.heating_set_room_temp_high
      - service: logbook.log
        data:
          entity_id: automation.advanced_heating_workdays_v2
          name: automation.advanced_heating_workdays_v2
          message: Started script.heating_set_room_temp_high
    default: []
  mode: single
- id: '1634985436165'
  alias: Advanced Heating Reset offsets v2
  description: Reset offsets with check
  trigger:
  - platform: time
    at: '23:05'
  condition: []
  action:
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 1
      offset: 0
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 2
      offset: 0
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 3
      offset: 0
  mode: single
- id: '1634986084052'
  alias: Advanced Heating HC3  v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "ok" and states(''sensor.thermostat_hc3_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "too-warm" and states(''sensor.thermostat_hc3_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "too-cold" and states(''sensor.thermostat_hc3_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: 3
    default: []
  mode: queued
  max: 10
- id: '1634986156492'
  alias: Advanced Heating HC1 v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "ok" and states(''sensor.thermostat_hc1_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "too-warm" and states(''sensor.thermostat_hc1_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "too-cold" and states(''sensor.thermostat_hc1_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: 3
    default:
    - service: alarm_control_panel.alarm_arm_away
  mode: queued
  max: 10
- id: '1634996229621'
  alias: Advanced Heating HC2 v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  - condition: template
    value_template: '{{ states(''sensor.thermostat_damped_outdoor_temperature'')|float
      <=10 }}'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "ok" and states(''sensor.thermostat_hc2_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "too-warm" and states(''sensor.thermostat_hc2_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "too-cold" and states(''sensor.thermostat_hc2_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: 3
    default: []
  mode: queued
  max: 10
- id: '1635933038164'
  alias: Advanced Rolladen KidsGross
  description: Rolladensteuerung KidsGross zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: time
    at: input_datetime.cover_morning_weekday
    id: wochentags
  - platform: time
    at: input_datetime.cover_morning_holiday
    id: wochentagsferien
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '19:45'
    id: abends2
  - platform: time
    at: input_datetime.cover_morning_weekend
    id: wochenende
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - service: cover.set_cover_position
        data:
          position: 5
        target:
          entity_id: cover.shelly25_og_clara
    - conditions:
      - condition: trigger
        id: wochentags
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: calendar.ferien
        state: 'off'
      sequence:
      - service: cover.set_cover_position
        target:
          entity_id: cover.shelly25_og_clara
        data:
          position: 100
    - conditions:
      - condition: trigger
        id: wochentagsferien
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: calendar.ferien
        state: 'on'
      sequence:
      - service: cover.set_cover_position
        target:
          entity_id: cover.shelly25_og_clara
        data:
          position: 100
    - conditions:
      - condition: trigger
        id: wochenende
      - condition: time
        weekday:
        - sat
        - sun
      sequence:
      - service: cover.set_cover_position
        target:
          entity_id: cover.shelly25_og_clara
        data:
          position: 100
    default: []
  mode: queued
  max: 10
- id: '1636051529526'
  alias: Send a camera snapshot when motion is detected
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: '{{ motion_sensor_name }} detected movement!'
      motion_sensor: binary_sensor.garagecam_person_detected
      camera: camera.mpeggaragecam
      notify_device: 433037e716d3d27ae2dd99df7a9818b0
      is_ios: true
      notification_title: Motion person detected!
      delay: 1
- id: '1636196197673'
  alias: 'q3 Wenn Person erkannt und dunkel draußen, dann LED-Fluter an '
  description: ''
  trigger:
  - platform: state
    from: 'off'
    to: 'on'
    entity_id: binary_sensor.garagecam_person_detected
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  mode: single
- id: '1639549122553'
  alias: Notebook aus wenn an
  description: switch is a button, can be removed if button entity is available
  trigger:
  - platform: state
    entity_id: switch.wake_up_thinkpad_t430
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.wake_up_thinkpad_t430
  mode: single
- id: '1639842026898'
  alias: Send a camera snapshot to Stefan when doorbell is pressed
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: Look who is there :-)
      motion_sensor: binary_sensor.doorbell_pressed
      camera: camera.mpeggaragecam
      notify_device: 433037e716d3d27ae2dd99df7a9818b0
      is_ios: true
      notification_title: Doorbell pressed!
      delay: 1
- id: '1640186426874'
  alias: Kalender Silvia
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.ha_silvia
    to: 'on'
    id: an
  - platform: state
    entity_id: calendar.ha_silvia
    id: aus
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellys_silvia
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellys_silvia
    default: []
  mode: single
- id: '1640281201989'
  alias: Kalender Schreibtisch
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.ha_schreibtisch
    to: 'on'
    id: an
  - platform: state
    entity_id:
    - calendar.ha_schreibtisch
    id: aus
    to: 'off'
  - platform: time
    at: '22:00'
    id: ausaus
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      - condition: state
        entity_id: calendar.ferien
        state: 'off'
      - condition: state
        entity_id: person.stefan
        state: home
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
        data: {}
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: aus
        - condition: trigger
          id: ausaus
      - condition: state
        entity_id: binary_sensor.stefan_working_in_office
        state: 'off'
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
        data: {}
    default: []
  mode: single
- id: '1640540334226'
  alias: Licht an, wenn sich Haustür im dunkeln öffnet oder der Klingelknopf gedrückt
    wurde
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    from: 'off'
    to: 'on'
  - platform: time
    at: input_datetime.haustur
  - platform: homeassistant
    event: start
  - platform: state
    entity_id: binary_sensor.doorbell_pressed
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - variables:
      swaobject: group.einfahrt
      is_on: '{{ is_state(swaobject, ''on'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.platform == ''state'' }}'
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id: '{{ swaobject }}'
      - service: input_datetime.set_datetime
        target:
          entity_id: input_datetime.haustur
        data:
          timestamp: '{{ (now() + timedelta(minutes=5)).timestamp()| int(0)  }}'
    - conditions:
      - condition: template
        value_template: '{{ (trigger.platform == ''time'' or trigger.platform == ''homeassistant''
          ) and is_on }}'
      sequence:
      - service: homeassistant.turn_off
        target:
          entity_id: '{{ swaobject }}'
  mode: single
- id: '1640788626220'
  alias: Heizung KidsGross Wochentags runterregeln
  description: Regelt die Heizung von 0700-1130 auf 19 Grad. Läuft nicht an Wochenende
    und in Ferien.
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - service: tado.set_climate_timer
    target:
      entity_id: climate.kidsgross
    data:
      time_period: 04:30:00
      temperature: 19
  mode: single
- id: '1640796447418'
  alias: Heizung KidsKlein Wochentags runterregeln
  description: Regelt die Heizung von 0700-1130 auf 19 Grad. Läuft nicht an Wochenende
    und in Ferien.
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - service: tado.set_climate_timer
    data:
      time_period: 04:30:00
      temperature: 19
    target:
      entity_id: climate.kidsklein
  mode: single
- id: '1640852446580'
  alias: 'Heizung KidsGross Offset '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kidsgross_temperature
    - sensor.multi_og_konstantin_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.kidsgross_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_konstantin_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.kidsgross
    data:
      offset: '{% set tado_temp = states(''sensor.kidsgross_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_konstantin_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.kidsgross'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1640852486884'
  alias: Heizung KidsKlein Offset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kidsklein_temperature
    - sensor.multi_og_clara_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.kidsklein_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_clara_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.kidsklein
    data:
      offset: '{% set tado_temp = states(''sensor.kidsklein_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_clara_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.kidsklein'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1641313703802'
  alias: Advanced Heating HC2HC1 v3
  description: Keep flow temp of HC2 below HC1 between 0500 and 2200. Check every
    15min.
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2_delta'')|float > 0.0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_HC2HC1_v2
          circuit: 2
          offset: '{{ [-(states(''sensor.heating_hc2_delta'')|float/3)|round(0,''floor''),-3]|max
            }}'
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2_delta'')|float <= 0.0 }}'
      - condition: template
        value_template: '{{ states(''sensor.thermostat_hc2_offset_temperature'') !=
          ''0'' }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_HC2HC1_v2
          circuit: 2
          offset: 0
    default: []
  mode: single
- id: '1641374827418'
  alias: Send a camera snapshot to Julia when doorbell is pressed
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: Look who is there :-)
      motion_sensor: binary_sensor.doorbell_pressed
      camera: camera.mpeggaragecam
      notify_device: b772f74b67a6ee614fe789c89d285156
      is_ios: true
      notification_title: Doorbell pressed!
      delay: 1
- id: '1641387275830'
  alias: 'Heizung OG Elternbad Offset '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.og_elternbad_temperature
    - sensor.multi_og_elternbad_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.og_elternbad_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_elternbad_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.og_elternbad
    data:
      offset: '{% set tado_temp = states(''sensor.og_elternbad_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_elternbad_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.og_elternbad'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1641412297937'
  alias: Disable motion detection for 5min
  description: Disable motion detection for 5min after motion has been detected or
    after main door opens. I receive too many pics.
  trigger:
  - platform: state
    entity_id: binary_sensor.garagecam_person_detected
    to: 'on'
  - platform: time
    at: input_datetime.motion
  - platform: homeassistant
    event: start
  - platform: state
    entity_id: binary_sensor.haustur
    to: 'on'
  condition: []
  action:
  - variables:
      swaobject: automation.send_a_camera_snapshot_when_motion_is_detected
      is_off: '{{ is_state(swaobject, ''off'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.platform == ''state'' }}'
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: automation.turn_off
        target:
          entity_id: '{{ swaobject }}'
      - service: input_datetime.set_datetime
        target:
          entity_id: input_datetime.motion
        data:
          timestamp: '{{ (now() + timedelta(minutes=5)).timestamp()| int(0)  }}'
    - conditions:
      - condition: template
        value_template: '{{ (trigger.platform == ''time'' or trigger.platform == ''homeassistant''
          ) and is_off }}'
      sequence:
      - service: automation.turn_on
        target:
          entity_id: '{{ swaobject }}'
    default: []
  mode: single
- id: '1641549085941'
  alias: Failed HTTP login attempt notification auto-dismiss
  description: ''
  trigger:
  - platform: state
    entity_id: persistent_notification.http_login
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ trigger.to_state.state is not none }}'
    - condition: template
      value_template: '{{ states.persistent_notification.http_login is not none }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ "192.168.178.36" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.20" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.46" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.22" in states.persistent_notification.http_login.attributes.message
        }}'
  action:
  - service: persistent_notification.dismiss
    data:
      notification_id: http_login
  mode: single
- id: '1641663171834'
  alias: Spotify setup
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: media_player.select_source
    target:
      entity_id: media_player.spotify_swa72
    data:
      source: Stefans Echo Dot
  - service: logbook.log
    data:
      entity_id: automation.spotify_setup
      message: Changed source to Stefans Echo Dot
      name: automation.spotify_setup
  mode: single
- id: '1642007555930'
  alias: Popup camera stream on wall tablet when doorbell pressed
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.doorbell_pressed
    to: 'on'
  condition: []
  action:
  - service: button.press
    target:
      entity_id: button.fire_tablet_bring_to_foreground
    data: {}
  - service: browser_mod.more_info
    data:
      entity: camera.mpeggaragecam
    target:
      device_id: c7f89cc7d1b7dc68db4d82e8893a23ee
  - service: script.alexa_doorbell_2
    data: {}
  mode: single
- id: '1642090677023'
  alias: Heizung DG Stefan Offset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.dg_stefan_temperature
    - sensor.multi_dg_stefan_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.dg_stefan_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_dg_stefan_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.dg_stefan
    data:
      offset: '{% set tado_temp = states(''sensor.dg_stefan_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_dg_stefan_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.dg_stefan'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1642524431688'
  alias: Charge Firetablet
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.fire_tablet_battery_level
    above: '80'
    id: stopcharge
  - platform: numeric_state
    entity_id: sensor.fire_tablet_battery_level
    id: startcharge
    below: '20'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: stopcharge
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellys_firetablet
  - choose:
    - conditions:
      - condition: trigger
        id: startcharge
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellys_firetablet
    default: []
  mode: single
- id: '1642611883513'
  alias: 'Notify Stefan of stale entities '
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /45
  condition: []
  action:
  - variables:
      stale: "{{ expand('group.tempsensors')\n   | selectattr('last_changed', 'lt',
        now()-timedelta(seconds=14400)) \n   | map(attribute='entity_id') | join(',
        ') }}\n"
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ stale | count > 0 }}'
    - condition: template
      value_template: '{{ stale != ''sensor.multi_og_aussen_temperature'' }}'
  - service: notify.mobile_app_iphonebwi12
    data:
      title: Stale Entities Found (no change in 2h)
      message: '{{ stale }}'
  mode: single
- id: '1647289595553'
  alias: Stefan DG zu warm
  description: Run only once every six hours.
  trigger:
  - platform: numeric_state
    entity_id: sensor.multi_dg_stefan_temperature
    above: '23'
  - platform: state
    entity_id: binary_sensor.stefan_working_in_office
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_dg_stefan_temperature
    above: '23'
  - condition: template
    value_template: '{{(as_timestamp(now()) - as_timestamp(state_attr(this.entity_id,
      ''last_triggered'') | default(0)) | int > 21600 )}}'
  action:
  - service: notify.mobile_app_iphonebwi12
    data:
      message: Office too hot. {{ states('sensor.multi_dg_stefan_temperature') | float
        | round(1) }}°C
      title: Warning
  mode: single
- id: '1648194455595'
  alias: Rainfall sensor update
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.precipitation_heidelberg
  condition:
  - condition: numeric_state
    entity_id: sensor.precipitation_heidelberg
    above: '0'
  - condition: template
    value_template: '{{ trigger.from_state.state not in [''unknown'', ''unavailable'']
      }}'
  - condition: template
    value_template: '{{ trigger.to_state.state not in [''unknown'', ''unavailable'']
      }}'
  - condition: template
    value_template: '{{ trigger.from_state.state != trigger.to_state.state }}'
  action:
  - service: mqtt.publish
    data:
      payload: '{{ now() }}'
      topic: home-assistant/variable/last_rainfall
      retain: true
  - service: mqtt.publish
    data:
      payload: '{{ states(''sensor.precipitation_heidelberg'') }}'
      topic: home-assistant/variable/last_rainfall_amount
      retain: true
  mode: single
- id: '1648655236587'
  alias: Rainfall sensor warning
  description: ''
  trigger:
  - platform: time
    at: '18:00:00'
  condition:
  - condition: template
    value_template: '{{ (states(''sensor.dwd_dayswithoutrain'')|int) % 4 == 0 and
      states(''sensor.dwd_dayswithoutrain'')|int != 0 }}'
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: 'Achtung: seit {{states(''sensor.dwd_dayswithoutrain'')}} Tagen kein
        Regen. Forecast checken und ggf. heute abend Garten sprengen.'
  mode: single
- id: '1652541844794'
  alias: Wenn SZ abends zu warm, turn on A/C
  description: ''
  trigger:
  - platform: time
    at: '19:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    above: '24'
  action:
  - service: notify.mobile_app_iphonebwi12
    data:
      title: Hinweis
      data:
        actions:
        - action: Turn_On_AC
          title: Turn On AC Now
      message: Schlafzimmer zu warm. Long tap for action.
  - wait_for_trigger:
    - platform: event
      event_type: ios.notification_action_fired
      event_data:
        actionName: Turn_On_AC
  - service: script.turn_on_ac_at_parents_sleeping_room
    data: {}
  mode: restart
- id: '1652542876674'
  alias: Last one left ...
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: zone.home
    below: '1'
  - platform: numeric_state
    entity_id: zone.home
    above: '0'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: zone.home
        state: '0'
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          title: Hinweis
          message: Last one left home.
    - conditions:
      - condition: state
        entity_id: zone.home
        state: '1'
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          title: Hinweis
          message: First one arrived at home.
    default: []
  mode: single
- id: '1653582309740'
  alias: Basement fan control with dewpoint
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.dew_delta_ok
    from: 'False'
    to: 'True'
    id: dewdeltaok
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.dewtimer_runfan
    id: runfanfinished
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.dewtimer_pausefan
    id: pausefanfinished
  - platform: time_pattern
    hours: '12'
    minutes: '00'
    seconds: '00'
    id: noon
  - platform: homeassistant
    event: start
    id: hastart
  - platform: event
    event_type: dew_event
    event_data:
      foo: bar
    id: waitfinished
  - platform: state
    entity_id:
    - binary_sensor.dew_timeframe
    to: 'off'
    id: timeframeend
  - platform: state
    entity_id:
    - binary_sensor.dew_timeframe
    to: 'on'
    id: timeframebegin
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - timeframebegin
        - dewdeltaok
        - hastart
        - waitfinished
      - condition: state
        entity_id: sensor.dew_delta_ok
        state: 'True'
      - condition: state
        entity_id: sensor.dew_humidity_ok
        state: 'True'
      - condition: state
        entity_id: sensor.dew_temp_ok
        state: 'True'
      - condition: state
        entity_id: binary_sensor.dew_timeframe
        state: 'on'
      - condition: numeric_state
        entity_id: counter.dew_index
        below: '7'
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.start
        data:
          duration: '{{states(''input_number.dew_duration_fan'')|int*60}}'
        target:
          entity_id: timer.dewtimer_runfan
      - service: counter.increment
        data: {}
        target:
          entity_id: counter.dew_index
    - conditions:
      - condition: trigger
        id: runfanfinished
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.start
        data:
          duration: '{{states(''input_number.dew_fan_wait'')|int*60}}'
        target:
          entity_id: timer.dewtimer_pausefan
    - conditions:
      - condition: trigger
        id: pausefanfinished
      sequence:
      - service: notify.persistent_notification
        data:
          message: Fan finished run {{ states('counter.dew_index') }}
        enabled: false
      - event: dew_event
        event_data:
          foo: bar
    - conditions:
      - condition: trigger
        id: noon
      sequence:
      - service: counter.reset
        data: {}
        target:
          entity_id: counter.dew_index
    - conditions:
      - condition: trigger
        id: timeframeend
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.cancel
        data: {}
        target:
          entity_id:
          - timer.dewtimer_pausefan
          - timer.dewtimer_runfan
    default:
    - service: notify.persistent_notification
      data:
        title: Fan control basement
        message: ' delta_ok {{states(''sensor.dew_delta_ok'')}} {{''\n''-}} hum_ok
          {{states(''sensor.dew_humidity_ok'')}} {{''\n''-}}temp_ok {{states(''sensor.dew_temp_ok'')}}
          {{''\n''-}}time_ok {{states(''binary_sensor.dew_timeframe'')}} {{''\n''-}}index
          {{states(''counter.dew_index'')}}'
      enabled: false
  mode: queued
- id: '1653590240171'
  alias: Stefan away
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Away
    id: away
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Extended Away
    id: extendedaway
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Home
    id: home
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Just Arrived
    id: justarrived
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Just Left
    id: justleft
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: home
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          message: Stefan is at home
    - conditions:
      - condition: trigger
        id: away
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          message: Stefan is away
    - conditions:
      - condition: trigger
        id: extendedaway
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          message: Stefan is extended away
    - conditions:
      - condition: trigger
        id: justarrived
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          message: Stefan just arrived
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: switch.shellyp_dg_stefan_tisch
        state: 'on'
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          title: Stefan just left
          message: Schreibtisch ist an.
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: binary_sensor.roofac_on
        state: 'on'
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          title: Stefan just left
          message: Klimaanlage im DG ist an.
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: binary_sensor.sleepac_on
        state: 'on'
      sequence:
      - service: notify.mobile_app_iphonebwi12
        data:
          title: Stefan just left
          message: Klimaanlage im Schlafzimmer ist an.
    default: []
  mode: single
- id: '1655667895530'
  alias: early espresso
  description: ''
  trigger:
  - platform: time
    at: 05:30:00
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      device_id: bc58f97050eebd88ad0456555080e14a
  mode: single
- id: '1656754284656'
  alias: Rolladen um 1100 runter wenn warm
  description: ''
  trigger:
  - platform: time
    at: '11:00:00'
  - platform: time
    at: '13:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    above: '24'
  action:
  - service: scene.turn_on
    data: {}
    target:
      entity_id: scene.schlafzimmer_halbdunkel
  mode: single
- id: '1656859295892'
  alias: Wenn ORP unter Schwellwert dann Nachricht an Julia und Stefan
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.pool_orp
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: '620'
  condition: []
  action:
  - service: notify.all_ios_parent_phones
    data:
      title: Pool needs help
      message: Temp {{states('sensor.pool_temp')|round(0)}}°C.   PH {{ states('sensor.pool_ph')|round(0)}}pH.   ORP
        {{ states('sensor.pool_orp')|round(0)}}mV
  mode: single
- id: '1662041910397'
  alias: Espresso counter
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_silvia_power
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: '800'
    id: silviastarted
  - platform: state
    entity_id:
    - binary_sensor.silvia_idle
    id: silviaidle
    to: 'on'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - repeat:
      until:
      - condition: template
        value_template: '{{ states(''sensor.shellys_silvia_power'')|float == 0 }}'
      sequence:
      - wait_for_trigger:
        - platform: numeric_state
          entity_id: sensor.shellys_silvia_power
          for:
            hours: 0
            minutes: 0
            seconds: 12
          above: '400'
      - service: counter.increment
        data: {}
        target:
          entity_id: counter.espresso
  mode: single
- id: '1664826413987'
  alias: HA started
  description: Notify Stefan that HA started.
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: notify.mobile_app_iphonebwi12
    data:
      message: HA started.
      title: Info
  mode: single
- id: '1665475720792'
  alias: Silvia Running Or Not
  description: On iff Silvia has recently started, or power greater zero and either
    HA restarted or automation reloaded.
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_silvia_power
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 0
    id: silvia_on_for_min
  - platform: state
    entity_id:
    - sensor.shellys_silvia_power
    to: '0.0'
    id: silvia_turned_off
  - platform: homeassistant
    event: start
    id: ha_started
  - platform: event
    event_type: call_service
    event_data:
      domain: automation
      service: reload
    id: automation_reload
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: silvia_on_for_min
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: ha_started
      sequence:
      - if:
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          above: 0
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          below: 200
        then:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.silvia_running
        else:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: automation_reload
      sequence:
      - if:
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          above: 0
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          below: 200
        then:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.silvia_running
        else:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: silvia_turned_off
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.silvia_running
  mode: single
- id: '1665476596754'
  alias: Silvia counter
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_silvia_power
    for:
      hours: 0
      minutes: 0
      seconds: 12
    above: '400'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.silvia_running
      state: 'on'
    then:
    - service: counter.increment
      data: {}
      target:
        entity_id: counter.silvia
    else:
    - service: notify.mobile_app_iphonebwi12
      data:
        title: Hinweis
        message: Counter Silvia not increased
  mode: single
- id: '1665485215974'
  alias: Watermeter read
  description: ''
  trigger:
  - platform: time
    at: '19:00:00'
  condition:
  - condition: template
    value_template: '{{(now().strftime("%d")|int>=24) and (now().strftime("%d")|int
      <=31) and (now().strftime("%w")|int==0)}}'
  action:
  - service: notify.mobile_app_iphonebwi12
    data:
      message: Read water meter (long press me)
      data:
        actions:
        - action: URI
          title: Open Url
          uri: /lovelace/meters
  mode: single
