- id: '1608636183988'
  alias: Notify, wenn Fenster zu lange offen und kalt draussen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:10:00
    to: 'on'
    entity_id: group.dachfenster
  - platform: state
    entity_id: group.ogfenster
    from: 'off'
    for: 00:10:00
    to: 'on'
  - platform: state
    entity_id: group.egfenster
    from: 'off'
    to: 'on'
    for: 00:10:00
  condition:
  - condition: numeric_state
    entity_id: sensor.heidelberg_temperature
    below: '15'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: '{% set w = expand( trigger.entity_id ) | selectattr(''state'', ''eq'',
        ''on'') | map(attribute=''name'') | list %} Fenster {{ w }} aus Gruppe {{
        trigger.to_state.attributes.friendly_name }} ist zu lange ({{trigger.for}}
        min) offen. Temperatur unter 15°C.'
  mode: single
- id: l1k3
  alias: Wenn Mitternacht, push HA configuration to GitHub repo
  trigger:
  - at: '23:23'
    platform: time
  action:
  - service: shell_command.push_to_github
    data: {}
  mode: single
- id: '1609858165994'
  alias: Windfanglicht bei Dunkelheit
  description: Windfanglicht an, wenn dunkel draußen; aus, wenn es hell wird
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'off'
    to: 'on'
    id: an
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    id: aus
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.licht_windfang
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.licht_windfang
    default: []
  mode: single
- id: '1609924669215'
  alias: q3 Wenn Volvo zuhause und lönger als 15min offen dann abschließen
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.volvo_zuhause_und_offen
    to: 'on'
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 15
      milliseconds: 0
  - service: lock.lock
    data: {}
    entity_id: lock.su_xp1654_door_lock
  mode: single
- id: '1611480761802'
  alias: Wenn Garage geöffnet wird und dunkel draußen, dann Flur-EG Licht an und LED-Fluter
    an
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.garagentur
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: d824de0a6c667da98e0f508d5d4129e5
    entity_id: switch.eg_flur_licht
    domain: switch
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  mode: single
- id: '1611495931370'
  alias: Wenn Kellerpumpe Treppe anläuft, dann Zähler erhöhen
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_keller_pumpe_treppe_power
    above: '5'
    for: 00:00:03
  condition: []
  action:
  - service: counter.increment
    data: {}
    entity_id: counter.kellerpumpe
  mode: single
- id: '1611496375383'
  alias: Wenn Mitternacht, dann Zähler zurücksetzen
  description: ''
  trigger:
  - platform: time
    at: 00:00
  condition: []
  action:
  - service: counter.reset
    data: {}
    target:
      entity_id:
      - counter.kellerpumpe
  mode: single
- id: '1611515523821'
  alias: zAlexa Media Player TTS/Announce from Lovelace UI
  description: ''
  use_blueprint:
    path: NachtaktiverHalbaffe/alexa-tts-announcement-from-lovelace-ui-and-without-nabu-casa-alexa-media-player.yaml
    input:
      message: input_text.swa_alexa_text
      target: input_select.swa_alexa_device
- id: '1612096410696'
  alias: Notify, wenn Waschmaschine fertig
  description: Waschmaschine fertig
  use_blueprint:
    path: Sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      finishing_hysteresis: 5
      power_sensor: sensor.shellys_wama_power
      starting_threshold: '100'
      starting_hysteresis: '3'
      finishing_threshold: '40'
      actions:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Waschmaschine ist fertig seit {{ '{:02}:{:02}'.format(now().hour,
            now().minute) }}.
      - service: script.alexa_wama_fertig
        data: {}
- id: '1612602466906'
  alias: Notify, wenn Katzentuer abends geschlossen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:05:00
    to: 'on'
    entity_id: binary_sensor.abend_eg_wohnzimmer_tuer_zu
  condition: []
  action:
  - service: script.alexa_doorbell
    data: {}
    entity_id: script.alexa_doorbell
  - service: script.alexa_tts_katzentur_offnen
    data: {}
    entity_id: script.alexa_tts_katzentur_offnen
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Die Wohnzimmertür für die Katzen offen lassen.
  mode: single
- id: '1612604258681'
  alias: q3 Notify, wenn  2000 Uhr und Volvo hat zu wenig Benzin
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: template
    value_template: '{{ states(''sensor.su_xp1654_fuel_amount'') | float < 10 }}'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Der Volvo hat nur noch {{ states('sensor.su_xp1654_fuel_amount') }}l
        Benzin.
  mode: single
- id: '1612709996219'
  alias: Notify, wenn Garage zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:30:00
    id: garage1
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:45:00
    id: garage2
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: garage1
        - condition: trigger
          id: garage2
      sequence:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Garagentor ist (zu lange) offen
    default: []
  mode: single
- id: '1612710199273'
  alias: Notify, wenn Haustür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    to: 'on'
    for: 00:10:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Haustür ist (zu lange) offen. Es hat {{ states('sensor.heidelberg_temperature')
        }} Grad draußen."
  mode: single
- id: '1612710265420'
  alias: Notify, wenn Kellertür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.kellertur
    to: 'on'
    for: 00:30:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Kellertür ist (zu lange) offen. Es hat {{ states('sensor.heidelberg_temperature')
        }} Grad draußen."
  mode: single
- id: '1612710429192'
  alias: Urgent Notify, wenn Freezer im Büro zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:02:00
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:04:00
  condition: []
  action:
  - if:
    - condition: time
      after: 09:00:00
      before: '22:00:00'
    then:
    - service: script.urgent_notify_people_who_are_present
      data:
        title: Hinweis
        message: Freezer im Büro ist (zu lange) offen.
    else:
    - service: script.notify_people_who_are_present
      data:
        title: Hinweis
        message: Freezer im Büro ist (zu lange) offen.
  mode: single
- id: '1616954536097'
  alias: Notify parents, wenn Luftfeuchtigkeit zu hoch
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_schlaf'') == ''on'' and
      states(''sensor.dew_og_schlaf_open_window'') }}'
    id: schlafzimmer
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_elternbad'') == ''on''
      and states(''sensor.dew_og_elternbad_open_window'') }}'
    id: elternbad
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_konstantin'')== ''on''
      and states(''sensor.dew_og_konstantin_open_window'') }}'
    id: konstantin
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_clara'') == ''on'' and
      states(''sensor.dew_og_clara_open_window'') }}'
    id: clara
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_eg_buro'') == ''on'' and states(''sensor.dew_eg_buro_open_window'')
      }}'
    id: Büro EG
  condition: []
  action:
  - service: script.notify_parents
    data:
      title: Hinweis
      message: '{{ trigger.to_state.attributes.friendly_name }} Bitte Fenster öffnen.'
  mode: queued
  max: 10
- id: '1620553045155'
  alias: Wenn zu warm im DG oder 0900 Uhr und Stefan im Office, frage Stefan ob AC
    angestellt werden soll
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.stefan_working_in_office
    to: 'on'
  - platform: time
    at: 09:00:00
  condition:
  - condition: template
    value_template: '{{states("sensor.multi_dg_stefan_temperature") | float >= 23}}'
  - condition: state
    entity_id: binary_sensor.stefan_working_in_office
    state: 'on'
  - condition: template
    value_template: '{{ is_state(''automation.notify_stefan_zu_heiss_in_dg'', ''off'')  }}'
  action:
  - alias: q1 Set up variables for the actions
    variables:
      action_on: '{{ ''ON_'' ~ context.id }}'
      action_nothing: '{{ ''NOTHING_'' ~ context.id }}'
  - alias: q1 Ask a question
    service: notify.mobile_app_iphone15b
    data:
      message: Temp too hot in office. Turn on AC?
      data:
        actions:
        - action: '{{ action_on }}'
          title: 'On'
        - action: '{{ action_nothing }}'
          title: No thanks
  - alias: q1 Wait for a response
    wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_on }}'
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_nothing }}'
  - alias: q1 Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_on}}'
      sequence:
      - service: script.turn_on_ac_at_stefans_office
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_nothing }}'
      sequence:
  mode: single
  max: 10
- id: '1623348230796'
  alias: Wenn Nacht, dann lasse Pool Pumpe laufen
  description: ''
  trigger:
  - platform: time
    at: '23:00'
  condition: []
  action:
  - type: turn_on
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  - delay:
      hours: 6
      minutes: 0
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  mode: single
- id: '1626027211313'
  alias: 'Notify Stefan, wenn major shelly und esp devices nicht verfügbar sind '
  description: ''
  use_blueprint:
    path: bfranke1973/device_connectivity_notification.yaml
    input:
      message: ' Hint: network connection lost for devices: {{ disconnected_servers
        }} '
      notify_device: fb01246b7faea05d42d7df1ff8e71a1b
      server_group: group.servers
- id: '1631904142960'
  alias: Advanced Heating Monitor_
  description: Sends message to Stefan if heating shows non-regular codes,  checks
    pressure, sets NTP time at night
  trigger:
  - platform: state
    entity_id: sensor.boiler_service_code
    to: 6A
    for:
      hours: 0
      minutes: 10
      seconds: 0
    id: servicecode
  - platform: time
    at: 00:01
    id: setntp
  - platform: numeric_state
    entity_id: sensor.boiler_system_pressure
    below: '1.9'
    id: heizungsdruck
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: servicecode
      sequence:
      - service: script.notify_stefan
        data:
          title: Heating
          message: 'Service Code: {{ states(''sensor.boiler_service_code'') }} Service
            Code Number: {{ states(''sensor.boiler_service_code_number'') }}'
    - conditions:
      - condition: trigger
        id: setntp
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"datetime","data":"ntp"}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: heizungsdruck
      sequence:
      - service: notify.persistent_notification
        data:
          title: Heating
          message: Heizungsdruck über 1h unter 1.9 bar.
  mode: single
- id: '1632288672635'
  alias: Notify, if basement dehumidifier is full
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.entfeuchter_voll
    to: 'True'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    id: entfeuchtervoll
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: entfeuchtervoll
      sequence:
      - service: script.notify_parents
        data: {}
      - service: script.alexa_tts_entfeuchter_voll
        data: {}
    default: []
  mode: single
- id: '1632543105220'
  alias: Power Save bei Waschmaschine
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_wama_power
    below: '4'
    above: '0'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch an.
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: numeric_state
    entity_id: sensor.shellys_wama_power
    above: '0'
    below: '4'
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch immer an.
  mode: single
- id: '1632671280558'
  alias: Advanced Monitor Stefan
  description: ''
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: heat_cool
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: cool
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.fenster_sw
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
    - condition: state
      entity_id: binary_sensor.fenster_o
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: Klimaanlage im DG läuft noch.
  mode: single
- id: '1633366928831'
  alias: Fake test automation
  description: ''
  trigger:
  - platform: time
    at: '19:02'
    id: swatrigger
  condition: []
  action:
  - service: script.notify_stefan
    data:
      title: automation.fake_test_automation
      message: foo bar {{ trigger.id }} {{ trigger.platform }}
  - service: logbook.log
    data:
      entity_id: automation.fake_test_automation
      message: some message
      name: automation.fake_test_automation
  mode: single
- id: '1634980794843'
  alias: Advanced Heating Forecast v2
  description: Set offset temp if next day is too warm/sunny with check
  trigger:
  - platform: time
    at: '23:30'
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.heating_forecast_condition
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].condition }}'
  - service: input_number.set_value
    target:
      entity_id: input_number.heating_forecast_temperature
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].temperature | float
        }}'
  - condition: state
    entity_id: sensor.heating_warmnextday
    state: warm
  - service: logbook.log
    data:
      message: Tomorrow will be warm ({{states('input_text.heating_forecast_condition')}}/     {{states('input_number.heating_forecast_temperature')}}).
        All offsets -3. If temp at night below 17, heating will likely still be off.
      name: automation.advanced_heating_forecast_v2
      entity_id: automation.advanced_heating_forecast_v2
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 1
      offset: -3
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 2
      offset: -3
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_forecast
      circuit: 3
      offset: -3
  mode: single
- id: '1634985348876'
  alias: Advanced Heating workdays v2
  description: Set temp low during Julia's workdays, skip holidays
  trigger:
  - platform: time
    at: 07:00
    id: morning
  - platform: time
    id: noon
    at: '12:00'
  condition:
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning
      - condition: time
        weekday:
        - wed
        - fri
      sequence:
      - service: script.heating_set_room_temp_low
        data: {}
      - service: logbook.log
        data:
          entity_id: automation.advanced_heating_workdays_v2
          name: automation.advanced_heating_workdays_v2
          message: Started script.heating_set_room_temp_low
    - conditions:
      - condition: trigger
        id: noon
      - condition: time
        weekday:
        - wed
        - fri
      sequence:
      - service: script.heating_set_room_temp_high
        data: {}
      - service: logbook.log
        data:
          entity_id: automation.advanced_heating_workdays_v2
          name: automation.advanced_heating_workdays_v2
          message: Started script.heating_set_room_temp_high
    default: []
  mode: single
- id: '1634985436165'
  alias: Advanced Heating Reset offsets v2
  description: Reset offsets with check
  trigger:
  - platform: time
    at: '23:05'
  condition: []
  action:
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 1
      offset: 0
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 2
      offset: 0
  - service: script.heating_change_offset
    data:
      origin: automation.advanced_heating_resetoffsets
      circuit: 3
      offset: 0
  mode: single
- id: '1634986084052'
  alias: Advanced Heating HC3  v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "ok" and states(''number.thermostat_hc3_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "too-warm" and states(''number.thermostat_hc3_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc3'') == "too-cold" and states(''number.thermostat_hc3_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc3
          circuit: 3
          offset: 3
    default: []
  mode: queued
  max: 10
- id: '1634986156492'
  alias: Advanced Heating HC1 v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "ok" and states(''number.thermostat_hc1_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "too-warm" and states(''number.thermostat_hc1_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc1'') == "too-cold" and states(''number.thermostat_hc1_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc1
          circuit: 1
          offset: 3
    default:
    - service: alarm_control_panel.alarm_arm_away
  mode: queued
  max: 10
- id: '1634996229621'
  alias: Advanced Heating HC2 v2
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /20
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  - condition: template
    value_template: '{{ states(''sensor.thermostat_damped_outdoor_temperature'')|float
      <=10 }}'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "ok" and states(''number.thermostat_hc2_offset_temperature'')|float
          != 0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: 0
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "too-warm" and states(''number.thermostat_hc2_offset_temperature'')|float
          != -3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: -3
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2'') == "too-cold" and states(''number.thermostat_hc2_offset_temperature'')|float
          != 3 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_hc2
          circuit: 2
          offset: 3
    default: []
  mode: queued
  max: 10
- id: '1635933038164'
  alias: Advanced Rolladen KidsGross
  description: Rolladensteuerung KidsGross zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '19:45'
    id: abends2
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - service: cover.set_cover_position
        data:
          position: 5
        target:
          entity_id: cover.shelly25_og_clara
    default: []
  mode: queued
  max: 10
- id: '1636051529526'
  alias: Send a camera snapshot when motion is detected
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: '{{ motion_sensor_name }} detected movement!'
      motion_sensor: binary_sensor.garagecam_person
      camera: camera.garagecam_sub
      notify_device: fb01246b7faea05d42d7df1ff8e71a1b
      is_ios: true
      notification_title: Motion person detected!
      delay: 1
- id: '1636196197673'
  alias: 'Wenn Person erkannt und dunkel draußen, dann LED-Fluter an '
  description: ''
  trigger:
  - platform: state
    from: 'off'
    to: 'on'
    entity_id: binary_sensor.garagecam_person_detected
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  mode: single
- id: '1639549122553'
  alias: Notebook aus wenn an
  description: switch is a button, can be removed if button entity is available
  trigger:
  - platform: state
    entity_id: switch.wake_up_thinkpad_t430
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.wake_up_thinkpad_t430
  mode: single
- id: '1639842026898'
  alias: Send a camera snapshot to Stefan when doorbell is pressed
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: Look who is there :-)
      motion_sensor: binary_sensor.doorbell_pressed
      camera: camera.garagecam_sub
      notify_device: fb01246b7faea05d42d7df1ff8e71a1b
      is_ios: true
      notification_title: Doorbell pressed!
      delay: 1
- id: '1640186426874'
  alias: Kalender Silvia
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.ha_silvia
    to: 'on'
    id: an
  - platform: state
    entity_id: calendar.ha_silvia
    id: aus
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellys_silvia
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellys_silvia
    default: []
  mode: single
- id: '1640281201989'
  alias: Kalender Schreibtisch
  description: ''
  trigger:
  - platform: state
    entity_id: calendar.ha_schreibtisch
    to: 'on'
    id: an
  - platform: state
    entity_id:
    - calendar.ha_schreibtisch
    id: aus
    to: 'off'
  - platform: time
    at: '22:00'
    id: ausaus
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: an
      - condition: state
        entity_id: calendar.ferien
        state: 'off'
      - condition: state
        entity_id: person.stefan
        state: home
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
        data: {}
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: aus
        - condition: trigger
          id: ausaus
      - condition: state
        entity_id: binary_sensor.stefan_working_in_office
        state: 'off'
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
        data: {}
    default: []
  mode: single
- id: '1640540334226'
  alias: Licht an, wenn sich Haustür im dunkeln öffnet oder der Klingelknopf gedrückt
    wurde
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    from: 'off'
    to: 'on'
  - platform: time
    at: input_datetime.haustur
  - platform: homeassistant
    event: start
  - platform: state
    entity_id: binary_sensor.doorbell_pressed
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - variables:
      swaobject: group.einfahrt
      is_on: '{{ is_state(swaobject, ''on'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.platform == ''state'' }}'
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id: '{{ swaobject }}'
      - service: input_datetime.set_datetime
        target:
          entity_id: input_datetime.haustur
        data:
          timestamp: '{{ (now() + timedelta(minutes=5)).timestamp()| int(0)  }}'
    - conditions:
      - condition: template
        value_template: '{{ (trigger.platform == ''time'' or trigger.platform == ''homeassistant''
          ) and is_on }}'
      sequence:
      - service: homeassistant.turn_off
        target:
          entity_id: '{{ swaobject }}'
  mode: single
- id: '1640788626220'
  alias: Heizung KidsGross Wochentags runterregeln
  description: Regelt die Heizung von 0700-1130 auf 19 Grad. Läuft nicht an Wochenende
    und in Ferien.
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - service: tado.set_climate_timer
    target:
      entity_id: climate.kidsgross
    data:
      time_period: 04:30:00
      temperature: 19
  mode: single
- id: '1640796447418'
  alias: Heizung KidsKlein Wochentags runterregeln
  description: Regelt die Heizung von 0700-1130 auf 19 Grad. Läuft nicht an Wochenende
    und in Ferien.
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: calendar.ferien
    state: 'off'
  action:
  - service: tado.set_climate_timer
    data:
      time_period: 04:30:00
      temperature: 19
    target:
      entity_id: climate.kidsklein
  mode: single
- id: '1640852446580'
  alias: 'Heizung KidsGross Offset '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kidsgross_temperature
    - sensor.multi_og_konstantin_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.kidsgross_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_konstantin_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.kidsgross
    data:
      offset: '{% set tado_temp = states(''sensor.kidsgross_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_konstantin_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.kidsgross'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1640852486884'
  alias: Heizung KidsKlein Offset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kidsklein_temperature
    - sensor.multi_og_clara_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.kidsklein_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_clara_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.kidsklein
    data:
      offset: '{% set tado_temp = states(''sensor.kidsklein_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_clara_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.kidsklein'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1641313703802'
  alias: Advanced Heating HC2HC1 v3
  description: Keep flow temp of HC2 below HC1 between 0500 and 2200. Check every
    15min.
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: time
    after: 05:00
    before: '22:00'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2_delta'')|float > 0.0 }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_HC2HC1_v3
          circuit: 2
          offset: '{{ [-(states(''sensor.heating_hc2_delta'')|float/3)|round(0,''floor''),-3]|max
            }}'
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2_delta'')|float <= 0.0 }}'
      - condition: template
        value_template: '{{ states(''number.thermostat_hc2_offset_temperature'') !=
          ''0'' }}'
      sequence:
      - service: script.heating_change_offset
        data:
          origin: automation.advanced_heating_HC2HC1_v3
          circuit: 2
          offset: 0
    default: []
  mode: single
- id: '1641374827418'
  alias: Send a camera snapshot to Julia when doorbell is pressed
  description: ''
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      notification_message: Look who is there :-)
      motion_sensor: binary_sensor.doorbell_pressed
      camera: camera.garagecam_sub
      notify_device: b772f74b67a6ee614fe789c89d285156
      is_ios: true
      notification_title: Doorbell pressed!
      delay: 1
- id: '1641387275830'
  alias: 'Heizung OG Elternbad Offset '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.og_elternbad_temperature
    - sensor.multi_og_elternbad_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.og_elternbad_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_og_elternbad_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.og_elternbad
    data:
      offset: '{% set tado_temp = states(''sensor.og_elternbad_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_og_elternbad_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.og_elternbad'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1641412297937'
  alias: Disable motion detection for 5min
  description: Disable motion detection for 5min after motion has been detected or
    after main door opens or I have arrived. I receive too many pics.
  trigger:
  - platform: state
    entity_id: binary_sensor.garagecam_person
    to: 'on'
  - platform: time
    at: input_datetime.motion
  - platform: homeassistant
    event: start
  - platform: state
    entity_id: binary_sensor.haustur
    to: 'on'
  - platform: state
    entity_id:
    - person.stefan
    from: not_home
    to: home
  condition: []
  action:
  - variables:
      swaobject: automation.send_a_camera_snapshot_when_motion_is_detected
      is_off: '{{ is_state(swaobject, ''off'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.platform == ''state'' }}'
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: automation.turn_off
        target:
          entity_id: '{{ swaobject }}'
      - service: input_datetime.set_datetime
        target:
          entity_id: input_datetime.motion
        data:
          timestamp: '{{ (now() + timedelta(minutes=5)).timestamp()| int(0)  }}'
    - conditions:
      - condition: template
        value_template: '{{ (trigger.platform == ''time'' or trigger.platform == ''homeassistant''
          ) and is_off }}'
      sequence:
      - service: automation.turn_on
        target:
          entity_id: '{{ swaobject }}'
    default: []
  mode: single
- id: '1641549085941'
  alias: Failed HTTP login attempt notification auto-dismiss
  description: ''
  trigger:
  - platform: state
    entity_id: persistent_notification.http_login
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ trigger.to_state.state is not none }}'
    - condition: template
      value_template: '{{ states.persistent_notification.http_login is not none }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ "192.168.178.36" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.20" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.46" in states.persistent_notification.http_login.attributes.message
        }}'
    - condition: template
      value_template: '{{ "192.168.178.22" in states.persistent_notification.http_login.attributes.message
        }}'
  action:
  - service: persistent_notification.dismiss
    data:
      notification_id: http_login
  mode: single
- id: '1641663171834'
  alias: Spotify setup
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: media_player.select_source
    target:
      entity_id: media_player.spotify_swa72
    data:
      source: Stefans Echo Dot
  - service: logbook.log
    data:
      entity_id: automation.spotify_setup
      message: Changed source to Stefans Echo Dot
      name: automation.spotify_setup
  mode: single
- id: '1642007555930'
  alias: Popup camera stream on wall tablet when doorbell pressed
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.doorbell_pressed
    to: 'on'
  condition: []
  action:
  - service: button.press
    target:
      entity_id: button.fire_tablet_bring_to_foreground
    data: {}
  - service: browser_mod.more_info
    data:
      entity: camera.garagecam_sub
      large: false
      ignore_popup_card: false
    target:
      device_id: c7f89cc7d1b7dc68db4d82e8893a23ee
  - service: script.alexa_doorbell_2
    data: {}
  mode: single
- id: '1642090677023'
  alias: Heizung DG Stefan Offset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.dg_stefan_temperature
    - sensor.multi_dg_stefan_temperature
  condition:
  - condition: template
    value_template: '{% set tado_temp = states(''sensor.dg_stefan_temperature'')|float(20)
      %} {% set room_temp = states(''sensor.multi_dg_stefan_temperature'')|float(20)
      %} {{ (tado_temp - room_temp) | abs > 0.5 }}

      '
  action:
  - service: tado.set_climate_temperature_offset
    target:
      entity_id: climate.dg_stefan
    data:
      offset: '{% set tado_temp = states(''sensor.dg_stefan_temperature'')|float(20)
        %} {% set room_temp = states(''sensor.multi_dg_stefan_temperature'')|float(20)
        %} {% set current_offset = state_attr(''climate.dg_stefan'', ''offset_celsius'')
        %} {{ (-(tado_temp - room_temp) + current_offset)|round(1) }}

        '
  mode: single
- id: '1642524431688'
  alias: Charge Firetablet
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.fire_tablet_battery_level
    above: '80'
    id: stopcharge
  - platform: numeric_state
    entity_id: sensor.fire_tablet_battery_level
    id: startcharge
    below: '20'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: stopcharge
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellys_firetablet
  - choose:
    - conditions:
      - condition: trigger
        id: startcharge
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellys_firetablet
    default: []
  mode: single
- id: '1642611883513'
  alias: 'Notify Stefan of stale entities '
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /45
  condition: []
  action:
  - variables:
      stale: "{{ expand('group.tempsensors')\n   | selectattr('last_changed', 'lt',
        now()-timedelta(seconds=14400)) \n   | map(attribute='entity_id') | join(',
        ') }}\n"
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ stale | count > 0 }}'
    - condition: template
      value_template: '{{ stale != ''sensor.multi_og_aussen_temperature'' }}'
  - service: script.notify_stefan
    data:
      title: Stale Entities Found (no change in 2h)
      message: '{{ stale }}'
  mode: single
- id: '1647289595553'
  alias: Stefan DG zu warm
  description: Run only once every six hours.
  trigger:
  - platform: numeric_state
    entity_id: sensor.multi_dg_stefan_temperature
    above: '23'
  - platform: state
    entity_id: binary_sensor.stefan_working_in_office
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_dg_stefan_temperature
    above: '23'
  - condition: template
    value_template: '{{(as_timestamp(now()) - as_timestamp(state_attr(this.entity_id,
      ''last_triggered'') | default(0)) | int > 21600 )}}'
  - condition: state
    entity_id: binary_sensor.stefan_working_in_office
    state: 'on'
  action:
  - service: script.notify_stefan
    data:
      message: Office too hot. {{ states('sensor.multi_dg_stefan_temperature') | float
        | round(1) }}°C
      title: Warning
  mode: single
- id: '1648194455595'
  alias: Rainfall sensor update
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.heidelberg_precipitation
  condition:
  - condition: numeric_state
    entity_id: sensor.heidelberg_precipitation
    above: '0'
  - condition: template
    value_template: '{{ trigger.from_state.state not in [''unknown'', ''unavailable'']
      }}'
  - condition: template
    value_template: '{{ trigger.to_state.state not in [''unknown'', ''unavailable'']
      }}'
  - condition: template
    value_template: '{{ trigger.from_state.state != trigger.to_state.state }}'
  action:
  - service: mqtt.publish
    data:
      payload: '{{ now() }}'
      topic: home-assistant/variable/last_rainfall
      retain: true
  - service: mqtt.publish
    data:
      payload: '{{ states(''sensor.heidelberg_precipitation'') }}'
      topic: home-assistant/variable/last_rainfall_amount
      retain: true
  mode: single
- id: '1648655236587'
  alias: Rainfall sensor warning
  description: ''
  trigger:
  - platform: time
    at: '18:00:00'
  condition:
  - condition: template
    value_template: '{{ (states(''sensor.dwd_dayswithoutrain'')|int) % 4 == 0 and
      states(''sensor.dwd_dayswithoutrain'')|int != 0 }}'
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: 'Achtung: seit {{states(''sensor.dwd_dayswithoutrain'')}} Tagen kein
        Regen. Forecast checken und ggf. heute abend Garten sprengen.'
  mode: single
- id: '1652541844794'
  alias: Wenn SZ abends zu warm, turn on A/C
  description: ''
  trigger:
  - platform: time
    at: '19:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    above: '24'
  action:
  - service: notify.mobile_app_iphone15b
    data:
      title: Hinweis
      data:
        actions:
        - action: Turn_On_AC
          title: Turn On AC Now
      message: Schlafzimmer zu warm. Long tap for action.
  - wait_for_trigger:
    - platform: event
      event_type: ios.notification_action_fired
      event_data:
        actionName: Turn_On_AC
  - service: script.turn_on_ac_at_parents_sleeping_room
    data: {}
  mode: restart
- id: '1652542876674'
  alias: Last one left ...
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: zone.home
    below: '1'
  - platform: numeric_state
    entity_id: zone.home
    above: '0'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: zone.home
        state: '0'
      sequence:
      - service: script.notify_stefan
        data:
          title: Hinweis
          message: Last one left home.
    - conditions:
      - condition: state
        entity_id: zone.home
        state: '1'
      sequence:
      - service: script.notify_stefan
        data:
          title: Hinweis
          message: First one arrived at home.
    default: []
  mode: single
- id: '1653582309740'
  alias: Basement fan control with dewpoint
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.dew_delta_ok
    from: 'False'
    to: 'True'
    id: dewdeltaok
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.dewtimer_runfan
    id: runfanfinished
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.dewtimer_pausefan
    id: pausefanfinished
  - platform: time_pattern
    hours: '12'
    minutes: '00'
    seconds: '00'
    id: noon
  - platform: homeassistant
    event: start
    id: hastart
  - platform: event
    event_type: dew_event
    event_data:
      foo: bar
    id: waitfinished
  - platform: state
    entity_id:
    - binary_sensor.dew_timeframe
    to: 'off'
    id: timeframeend
  - platform: state
    entity_id:
    - binary_sensor.dew_timeframe
    to: 'on'
    id: timeframebegin
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - timeframebegin
        - dewdeltaok
        - hastart
        - waitfinished
      - condition: state
        entity_id: sensor.dew_delta_ok
        state: 'True'
      - condition: state
        entity_id: sensor.dew_humidity_ok
        state: 'True'
      - condition: state
        entity_id: sensor.dew_temp_ok
        state: 'True'
      - condition: state
        entity_id: binary_sensor.dew_timeframe
        state: 'on'
      - condition: numeric_state
        entity_id: counter.dew_index
        below: '7'
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.start
        data:
          duration: '{{states(''input_number.dew_duration_fan'')|int*60}}'
        target:
          entity_id: timer.dewtimer_runfan
      - service: counter.increment
        data: {}
        target:
          entity_id: counter.dew_index
    - conditions:
      - condition: trigger
        id: runfanfinished
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.start
        data:
          duration: '{{states(''input_number.dew_fan_wait'')|int*60}}'
        target:
          entity_id: timer.dewtimer_pausefan
    - conditions:
      - condition: trigger
        id: pausefanfinished
      sequence:
      - service: notify.persistent_notification
        data:
          message: Fan finished run {{ states('counter.dew_index') }}
        enabled: false
      - event: dew_event
        event_data:
          foo: bar
    - conditions:
      - condition: trigger
        id: noon
      sequence:
      - service: counter.reset
        data: {}
        target:
          entity_id: counter.dew_index
    - conditions:
      - condition: trigger
        id: timeframeend
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.shellys_keller_luefter1
      - service: timer.cancel
        data: {}
        target:
          entity_id:
          - timer.dewtimer_pausefan
          - timer.dewtimer_runfan
    default:
    - service: notify.persistent_notification
      data:
        title: Fan control basement
        message: ' delta_ok {{states(''sensor.dew_delta_ok'')}} {{''\n''-}} hum_ok
          {{states(''sensor.dew_humidity_ok'')}} {{''\n''-}}temp_ok {{states(''sensor.dew_temp_ok'')}}
          {{''\n''-}}time_ok {{states(''binary_sensor.dew_timeframe'')}} {{''\n''-}}index
          {{states(''counter.dew_index'')}}'
      enabled: false
  mode: queued
- id: '1653590240171'
  alias: Stefan away automatic
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Away
    id: away
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Extended Away
    id: extendedaway
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Home
    id: home
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Just Arrived
    id: justarrived
  - platform: state
    entity_id:
    - sensor.stefan_location
    to: Just Left
    id: justleft
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: home
      sequence:
      - service: script.notify_stefan
        data:
          message: Stefan is at home
    - conditions:
      - condition: trigger
        id: away
      sequence:
      - service: script.notify_stefan
        data:
          message: Stefan is away
    - conditions:
      - condition: trigger
        id: extendedaway
      sequence:
      - service: script.notify_stefan
        data:
          message: Stefan is extended away
    - conditions:
      - condition: trigger
        id: justarrived
      sequence:
      - service: script.notify_stefan
        data:
          message: Stefan just arrived
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: switch.shellyp_dg_stefan_tisch
        state: 'on'
      sequence:
      - service: script.notify_stefan
        data:
          title: Stefan just left
          message: Schreibtisch ist an.
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: binary_sensor.roofac_on
        state: 'on'
      sequence:
      - service: script.notify_stefan
        data:
          title: Stefan just left
          message: Klimaanlage im DG ist an.
    - conditions:
      - condition: trigger
        id: justleft
      - condition: state
        entity_id: binary_sensor.sleepac_on
        state: 'on'
      sequence:
      - service: script.notify_stefan
        data:
          title: Stefan just left
          message: Klimaanlage im Schlafzimmer ist an.
    default: []
  mode: single
- id: '1655667895530'
  alias: Early espresso
  description: ''
  trigger:
  - platform: time
    at: 05:30:00
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      device_id: bc58f97050eebd88ad0456555080e14a
  mode: single
- id: '1656754284656'
  alias: Rolladen um 1100 runter wenn warm
  description: ''
  trigger:
  - platform: time
    at: '11:00:00'
  - platform: time
    at: '13:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    above: '24'
  action:
  - service: scene.turn_on
    data: {}
    target:
      entity_id: scene.schlafzimmer_halbdunkel
  mode: single
- id: '1656859295892'
  alias: Wenn ORP unter Schwellwert dann Nachricht an Julia und Stefan
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.pool_orp
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: '620'
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Pool needs help
      message: Temp {{states('sensor.pool_temp')|round(0)}}°C.   PH {{ states('sensor.pool_ph')|round(0)}}pH.   ORP
        {{ states('sensor.pool_orp')|round(0)}}mV
  mode: single
- id: '1664826413987'
  alias: HA started
  description: Notify Stefan that HA started.
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: HA started.
      title: Info
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: climate.turn_off
    data: {}
    target:
      entity_id:
      - climate.roofac
      - climate.sleepac
  mode: single
- id: '1665475720792'
  alias: Silvia Running Or Not
  description: On iff Silvia has recently started, or power greater zero and either
    HA restarted or automation reloaded.
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_silvia_power
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 0
    id: silvia_on_for_min
  - platform: state
    entity_id:
    - sensor.shellys_silvia_power
    to: '0.0'
    id: silvia_turned_off
  - platform: homeassistant
    event: start
    id: ha_started
  - platform: event
    event_type: call_service
    event_data:
      domain: automation
      service: reload
    id: automation_reload
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: silvia_on_for_min
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: ha_started
      sequence:
      - if:
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          above: 0
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          below: 200
        then:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.silvia_running
        else:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: automation_reload
      sequence:
      - if:
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          above: 0
        - condition: numeric_state
          entity_id: sensor.shellys_silvia_power
          below: 200
        then:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.silvia_running
        else:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.silvia_running
    - conditions:
      - condition: trigger
        id: silvia_turned_off
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.silvia_running
  mode: single
- id: '1665476596754'
  alias: Silvia counter
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_silvia_power
    for:
      hours: 0
      minutes: 0
      seconds: 12
    above: '400'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.silvia_running
      state: 'on'
    then:
    - service: counter.increment
      data: {}
      target:
        entity_id: counter.silvia
    else:
    - service: script.notify_stefan
      data:
        title: Hinweis
        message: Counter Silvia not increased
      enabled: false
  mode: single
- id: '1671871958843'
  alias: Notify, wenn 2000 Uhr und Tesla weniger als 300km
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  - platform: time
    at: 08:30:00
  condition:
  - condition: template
    value_template: '{{ states(''sensor.range'') | float < 300 }}'
  - condition: template
    value_template: '{{ states(''device_tracker.location_tracker'') == ''home'' }}'
  - condition: template
    value_template: '{{ states(''binary_sensor.charger'') == ''off'' }}'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Der Tesla hat nur noch {{ states('sensor.range') | round(0)}}km Reichweite.
  mode: single
- id: '1672679486579'
  alias: Notify people to clean Silvia
  description: Notify people who are present, if Silvia is more than 90 espresso deep
  trigger:
  - platform: time
    at: '18:00:00'
  condition:
  - condition: numeric_state
    entity_id: counter.silvia
    above: 61
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: 'Silvia hat mehr als 60 Espresso zubereitet - bitte reinigen. Letzmalig
        erinnert vor Tagen: {{ (as_timestamp(now()) - as_timestamp(state_attr("automation.notify_people_to_clean_silvia",
        "last_triggered")) ) | timestamp_custom("%j")| int }}'
  mode: single
- id: '1672759483746'
  alias: Notify if Tesla Wall Charger no longer connected
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.tesla_wall_connector_vehicle_connected
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Die Tesla Wallbox ist nicht mehr in Nutzung.
  mode: single
- id: '1685033987732'
  alias: Garage button in iOS
  description: garage button
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: Garage
  condition: []
  action:
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.garage_door
  mode: single
- id: '1685034600317'
  alias: Haustur iOS
  description: Haustur iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: Haustuer
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: haustuer
    enabled: false
  - service: script.haustuer
    data: {}
    enabled: true
  mode: single
- id: '1685336963150'
  alias: Tesla button in iOS
  description: Tesla button in iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: Tesla
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: tesla
    enabled: false
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.trunk
  mode: single
- id: '1685337090913'
  alias: DGoffen Button in iOS
  description: DGoffen Button in iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: dgoffen
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: dgoffen
    enabled: false
  - service: scene.turn_on
    target:
      entity_id: scene.dg_stefan_offen
    metadata: {}
  mode: single
- id: '1685337159213'
  alias: DGvideo Button in iOS
  description: DGvideo Button in iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: dgvideo
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: dgvideo
    enabled: false
  - service: scene.turn_on
    target:
      entity_id: scene.dg_stefan_video
    metadata: {}
  mode: single
- id: '1685337237151'
  alias: SZmorgens Button in iOS
  description: SZmorgens Button in iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: szmorgens
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: szmorgens
    enabled: false
  - service: scene.turn_on
    target:
      entity_id: scene.schlafzimmer_morgen
    metadata: {}
  mode: single
- id: '1685337304628'
  alias: SZabends Button in iOS
  description: SZabends Button in iOS
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: szabends
  condition: []
  action:
  - service: script.notify_stefan
    data:
      message: szabends
    enabled: false
  - service: scene.turn_on
    target:
      entity_id: scene.sz_luften_nachts
    metadata: {}
  mode: single
- id: '1687625943302'
  alias: SZ Klima in der Nacht aus
  description: ''
  trigger:
  - platform: time
    at: 00:30:00
  condition:
  - condition: template
    value_template: '{{ states(''climate.sleepac'') != ''off'' }} '
  action:
  - service: climate.turn_off
    data: {}
    target:
      entity_id: climate.sleepac
  mode: single
- id: '1687710708216'
  alias: Irrigation Notification
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.shellys_garage_grossehecke
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - switch.hecke
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - switch.rasen
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: notify.persistent_notification
    data:
      message: N/A
      title: 'Bewässerung beendet: {{ trigger.entity_id }}'
  mode: single
- id: '1688653635979'
  alias: Stefan returned home
  description: ''
  trigger:
  - platform: state
    entity_id:
    - person.stefan
    from: not_home
    to: home
  condition: []
  action:
  - alias: q1 Set up variables for the actions
    variables:
      action_on: '{{ ''ON_'' ~ context.id }}'
      action_nothing: '{{ ''NOTHING_'' ~ context.id }}'
  - alias: q1 Ask a question
    service: notify.mobile_app_iphone15b
    data:
      message: Haustür öffnen?
      data:
        actions:
        - action: '{{ action_on }}'
          title: Ja.
        - action: '{{ action_nothing }}'
          title: Nein, danke.
  - alias: q1 Wait for a response
    wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_on }}'
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_nothing }}'
  - alias: q1 Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_on}}'
      sequence:
      - service: script.haustuer
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_nothing }}'
      sequence:
  mode: restart
- id: '1689592142929'
  alias: Notify Stefan of meter problem
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.watermain_problem
    from:
    to: 'on'
    for:
      hours: 1
      minutes: 30
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.watermain_error'') is search(''Neg. Rate'')
          }}'
      sequence:
      - service: notify.persistent_notification
        data:
          title: Hinweis
          message: '{{ trigger.entity_id }} has negative read problem: {{ states(''sensor.watermain_error'')
            }}'
      - service: mqtt.publish
        data:
          topic: watermain/ctrl/set_prevalue
          payload: '{"numbersname": "main", "value": -1}'
    default:
    - service: notify.persistent_notification
      data:
        title: Hinweis
        message: '{{ trigger.entity_id }} has other meter problem: {{ states(''sensor.watermain_error'')
          }}'
  mode: single
- id: '1689599626718'
  alias: Toggle aircondition in roof
  description: ''
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: dgklima
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: climate.roofac
        state: 'off'
      sequence:
      - service: climate.set_fan_mode
        target:
          entity_id: climate.roofac
        data:
          fan_mode: low
      - service: climate.set_temperature
        target:
          entity_id: climate.roofac
        data:
          temperature: 25
          hvac_mode: cool
    - conditions:
      - condition: state
        entity_id: climate.roofac
        state: cool
      sequence:
      - service: climate.turn_off
        data: {}
        target:
          entity_id: climate.roofac
  mode: single
- id: '1694323173424'
  alias: Kalender Schreibtisch AusAus
  description: Turns off at 2200
  trigger:
  - platform: time
    at: '22:00'
    id: ausaus
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: ausaus
      - condition: state
        entity_id: binary_sensor.stefan_working_in_office
        state: 'off'
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
        data: {}
    default: []
  mode: single
- id: '1702141770373'
  alias: eMail notification charger plugged in
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.tesla_wall_connector_vehicle_connected
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: camera.snapshot
    target:
      device_id: 25690f6e83a880a4b64af9e64ba94b4e
    data:
      filename: /config/temp/garagegam-foo.jpg
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: notify.email_notification
    data:
      message: Tesla charger plugged in
      title: Tesla charger plugged in
      data:
        images:
        - /config/temp/garagegam-foo.jpg
  mode: single
- id: '1706004056913'
  alias: Turn on heating in Kinderbad using Blueprint
  description: ''
  use_blueprint:
    path: samnewman86/ikea-tradfri-2-button-on-off-switch-long-and-short-presses.yaml
    input:
      remote: 85bfc7b87d35da019a50570d2e25f9dc
      button_on_short:
      - condition: numeric_state
        entity_id: sensor.multi_og_kinderbad_temperature
        below: 22
      - service: switch.turn_on
        target:
          device_id:
          - 5929cf4364fb0096bd6b45f8d450cc79
        data: {}
      button_off_short:
      - service: switch.turn_off
        metadata: {}
        data: {}
        target:
          device_id: 5929cf4364fb0096bd6b45f8d450cc79
- id: '1710175526937'
  alias: Warnung Geraet fehlt auf Anrichte
  description: ''
  trigger:
  - platform: time_pattern
    hours: 18
    minutes: /15
  - platform: time_pattern
    hours: 19
    minutes: /15
  - platform: time_pattern
    hours: 20
    minutes: /15
  condition: []
  action:
  - if:
    - condition: numeric_state
      entity_id: sensor.ipad_rot
      attribute: distance
      above: 2
    - condition: time
      after: '18:29:00'
      before: '20:16:00'
    then:
    - service: script.notify_stefan_only_if_really_present
      metadata: {}
      data:
        title: Hinweis
        message: Das iPad von Konstantin fehlt auf der Anrichte.
    - service: media_player.volume_set
      data:
        volume_level: 0.5
      entity_id: media_player.stefans_echo_dot
    - service: notify.alexa_media
      data:
        target: media_player.stefans_echo_dot
        message: Das iPad von Konstantin fehlt auf der Anrichte.
        data:
          type: tts
    - service: media_player.volume_set
      data:
        volume_level: 0.2
      target:
        entity_id: media_player.stefans_echo_dot
  - if:
    - condition: numeric_state
      entity_id: sensor.iphone_clara
      attribute: distance
      above: 2
    - condition: time
      after: '19:29:00'
      before: '20:16:00'
    then:
    - service: script.notify_stefan_only_if_really_present
      metadata: {}
      data:
        title: Hinweis
        message: Das iPhone von Clara fehlt auf der Anrichte.
    - service: media_player.volume_set
      data:
        volume_level: 0.5
      entity_id: media_player.stefans_echo_dot
    - service: notify.alexa_media
      data:
        target: media_player.stefans_echo_dot
        message: Das iPhone von Clara fehlt auf der Anrichte.
        data:
          type: tts
    - service: media_player.volume_set
      data:
        volume_level: 0.2
      target:
        entity_id: media_player.stefans_echo_dot
  mode: single
- id: '1710217827661'
  alias: Warnung ESPresense Geraet fehlt
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.espresense_esppkidsgross_espresense_esppkidsgross
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition: []
  action:
  - service: script.notify_stefan_only_if_really_present
    data:
      title: Hinweis
      message: ESPresense keine Verbindung mehr.
  - service: notify.persistent_notification
    data:
      message: ESPresense keine Verbindung mehr.
      title: Hinweis
  mode: single
- id: '1712903556652'
  alias: Notify stefan critically if doorbell pressed and helper set
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.doorbell_pressed
    to: 'on'
    from: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.stefan_critical
    state: 'on'
  action:
  - service: script.urgent_notify_stefan
    data:
      title: Tür
      message: Türklingel wurde gedrückt
  mode: single
- id: '1713470741508'
  alias: Stefan Away
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.stefan_away
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - input_boolean.stefan_away
    from: 'off'
    to: 'on'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.stefan_away
      state: 'on'
    then:
    - service: notify.persistent_notification
      metadata: {}
      data:
        message: Stefan ist abwesend.
    - service: automation.turn_off
      metadata: {}
      data:
        stop_actions: true
      target:
        entity_id: automation.kalender_schreibtisch
    - service: automation.turn_off
      metadata: {}
      data:
        stop_actions: true
      target:
        entity_id: automation.kalender_silvia
    - service: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.shellys_silvia
    - service: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.shellyp_dg_stefan_tisch
  - if:
    - condition: state
      entity_id: input_boolean.stefan_away
      state: 'off'
    then:
    - service: notify.persistent_notification
      metadata: {}
      data:
        message: Stefan ist anwesend.
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.kalender_schreibtisch
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.kalender_silvia
  mode: single
- id: '1713471830418'
  alias: Family away
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.family_away
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - input_boolean.family_away
    from: 'off'
    to: 'on'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.family_away
      state: 'on'
    then:
    - service: notify.persistent_notification
      metadata: {}
      data:
        message: Familie ist abwesend.
    - service: automation.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: automation.warnung_espresense_geraet_fehlt
    - service: automation.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: automation.warnung_konstantin_geraet_fehlt
    - service: automation.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: automation.advanced_heating_workdays_v2
    - service: automation.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: automation.advanced_heating_hc2hc1_v3
    - service: select.select_option
      metadata: {}
      data:
        option: 'off'
      target:
        entity_id: select.thermostat_dhw_mode
    - service: select.select_option
      metadata: {}
      data:
        option: manual
      target:
        entity_id: select.thermostat_hc1_mode
    - service: select.select_option
      metadata: {}
      data:
        option: manual
      target:
        entity_id: select.thermostat_hc2_mode
    - service: select.select_option
      metadata: {}
      data:
        option: manual
      target:
        entity_id: select.thermostat_hc3_mode
  - if:
    - condition: state
      entity_id: input_boolean.family_away
      state: 'off'
    then:
    - service: notify.persistent_notification
      metadata: {}
      data:
        message: Familie ist anwesend.
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.warnung_espresense_geraet_fehlt
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.warnung_konstantin_geraet_fehlt
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.advanced_heating_workdays_v2
    - service: automation.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: automation.advanced_heating_hc2hc1_v3
    - service: select.select_option
      metadata: {}
      data:
        option: own prog
      target:
        entity_id: select.thermostat_dhw_mode
    - service: select.select_option
      metadata: {}
      data:
        option: auto
      target:
        entity_id: select.thermostat_hc1_mode
    - service: select.select_option
      metadata: {}
      data:
        option: auto
      target:
        entity_id: select.thermostat_hc2_mode
    - service: select.select_option
      metadata: {}
      data:
        option: auto
      target:
        entity_id: select.thermostat_hc3_mode
  mode: single
- id: '1713514008301'
  alias: Rolladensteuerung Schlafzimmer runter
  description: Rolladensteuerung Schlafzimmer runter
  trigger:
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '21:00'
    id: abends2
  - platform: homeassistant
    event: start
    id: hastart
  - platform: event
    event_type:
    - automation_reloaded
    id: automation_reloaded
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - scene: scene.schlafzimmer_abend_sommer
    default: []
  max: 10
- id: '1713992878476'
  alias: Notify Badge Count
  description: ''
  trigger:
  - platform: persistent_notification
    update_type:
    - removed
    notification_id: ''
    id: DECREMENT
  - platform: persistent_notification
    update_type:
    - added
    notification_id: ''
    id: INCREMENT
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - DECREMENT
      sequence:
      - service: counter.decrement
        target:
          entity_id: counter.notification_count
        data: {}
      - service: notify.all_notify
        data:
          message: delete_alert
          data:
            push:
              badge: '{{states(''counter.notification_count'')}}'
    - conditions:
      - condition: trigger
        id:
        - INCREMENT
      sequence:
      - service: counter.increment
        target:
          entity_id:
          - counter.notification_count
        data: {}
      - service: notify.all_notify
        data:
          message: ''
          data:
            push:
              badge: '{{states(''counter.notification_count'')}}'
  mode: queued
  max: 10
- id: '1715579133932'
  alias: Cover adjustment for next day
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  - platform: state
    entity_id:
    - input_boolean.cover_late
    to: 'on'
  - platform: state
    entity_id:
    - input_boolean.cover_late
    to: 'off'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.cover_late
      state: 'on'
    then:
    - service: input_datetime.set_datetime
      metadata: {}
      data_template:
        entity_id: input_datetime.cover_result
        time: '{{ states(''input_datetime.cover_weekends'') }}'
    else:
    - if:
      - condition: state
        entity_id: binary_sensor.workday_sensor_tomorrow
        state: 'off'
      then:
      - service: input_datetime.set_datetime
        metadata: {}
        data_template:
          entity_id: input_datetime.cover_result
          time: '{{ states(''input_datetime.cover_weekends'') }}'
      else:
      - service: input_datetime.set_datetime
        metadata: {}
        data_template:
          entity_id: input_datetime.cover_result
          time: '{{ states(''input_datetime.cover_weekdays'') }}'
  mode: single
