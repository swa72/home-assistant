- id: '1608063965030'
  alias: q3 Wenn neue Version dann Nachricht an Stefan
  trigger:
  - platform: state
    entity_id: binary_sensor.updater
    from: 'off'
    to: 'on'
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version')
        }} is now available.
  mode: single
- id: '1608480614730'
  alias: q3 Wenn Haustür geöffnet wird und dunkel draußen, dann Flur-EG Licht an und
    LED-Fluter an
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: d824de0a6c667da98e0f508d5d4129e5
    entity_id: switch.eg_flur_licht
    domain: switch
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  - service: script.schalte_aussenlicht_fur_5min_an
    data: {}
  mode: single
- id: '1608633463304'
  alias: Rolladen Schlafzimmer
  description: Rolladensteuerung Schlafzimmer zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: time
    at: 07:45:00
    id: morgens-wochentag
  - platform: time
    at: 09:00:00
    id: morgens-wochenende
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '21:00'
    id: abends2
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - scene: scene.schlafzimmer_abend_sommer
    - conditions:
      - condition: trigger
        id: morgens-wochentag
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: morgens-wochenende
      - condition: time
        weekday:
        - sat
        - sun
      sequence:
      - scene: scene.schlafzimmer_morgen
    default: []
  mode: single
- id: '1608636183988'
  alias: q3 Notify, wenn Fenster zu lange offen und kalt draussen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:10:00
    to: 'on'
    entity_id: group.dachfenster
  - platform: state
    entity_id: group.ogfenster
    from: 'off'
    for: 00:10:00
    to: 'on'
  - platform: state
    entity_id: group.egfenster
    from: 'off'
    to: 'on'
    for: 00:10:00
  condition:
  - condition: numeric_state
    entity_id: weather.home
    value_template: '{{ state.attributes.temperature }}'
    below: '15'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: '{% set w = expand( trigger.entity_id ) | selectattr(''state'', ''eq'',
        ''on'') | map(attribute=''name'') | list %} Fenster {{ w }} aus Gruppe {{
        trigger.to_state.attributes.friendly_name }} ist zu lange ({{trigger.for}}
        min) offen. Temperatur unter 15°C.'
  mode: single
- id: l1k3
  alias: q3 Wenn Mitternacht, push HA configuration to GitHub repo
  trigger:
  - at: '23:23:00'
    platform: time
  action:
  - data:
      addon: a0d7b954_ssh
      input: /config/gitpush.sh
    service: hassio.addon_stdin
  mode: single
- id: '1609245232653'
  alias: q3 Wenn dunkel draußen,  Außenlicht an
  description: Außenlicht an, wenn dunkel draußen
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    entity_id: switch.licht_aussen
  mode: single
- id: '1609245648666'
  alias: q3 Wenn hell draußen, Außenlicht aus
  description: Außenlicht aus, wenn hell draußen
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: switch.turn_off
    data: {}
    entity_id: switch.licht_aussen
  mode: single
- id: '1609858165994'
  alias: q3 Wenn dunkel draußen, dann Windfanglicht an
  description: Windfanglicht an, wenn dunkel draußen
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    entity_id: switch.licht_windfang
  mode: single
- id: '1609858227328'
  alias: q3 Wenn hell draußen, dann Windfanglicht  aus
  description: Windfanglicht  aus, wenn hell draußen
  trigger:
  - platform: state
    entity_id: binary_sensor.dunkel_draussen
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: switch.turn_off
    data: {}
    entity_id: switch.licht_windfang
  mode: single
- id: '1609924669215'
  alias: q3 Wenn Volvo zuhause und lönger als 15min offen dann abschließen
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.volvo_zuhause_und_offen
    to: 'on'
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 15
      milliseconds: 0
  - service: lock.lock
    data: {}
    entity_id: lock.su_xp1654_door_lock
  mode: single
- id: '1611480761802'
  alias: q3 Wenn Garage geöffnet wird und dunkel draußen, dann Flur-EG Licht an und
    LED-Fluter an
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.garagentur
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dunkel_draussen
    state: 'on'
  action:
  - type: turn_on
    device_id: d824de0a6c667da98e0f508d5d4129e5
    entity_id: switch.eg_flur_licht
    domain: switch
  - type: turn_on
    device_id: 33202a9524f56b2023ed57884e81af71
    entity_id: switch.shelly25_garage_channel_2
    domain: switch
  mode: single
- id: '1611495931370'
  alias: q3 Wenn Kellerpumpe Treppe anläuft, dann Zähler erhöhen
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_keller_pumpe_treppe_power
    above: '5'
    for: 00:00:03
  condition: []
  action:
  - service: counter.increment
    data: {}
    entity_id: counter.kellerpumpe
  mode: single
- id: '1611496375383'
  alias: q3 Wenn Mitternacht, dann Zähler zurücksetzen
  description: ''
  trigger:
  - platform: time
    at: 00:00
  condition: []
  action:
  - service: counter.reset
    data: {}
    target:
      entity_id:
      - counter.kellerpumpe
      - counter.dew_fans
  mode: single
- id: '1611515523821'
  alias: q3 zAlexa Media Player TTS/Announce from Lovelace UI
  description: ''
  use_blueprint:
    path: NachtaktiverHalbaffe/alexa-tts-announcement-from-lovelace-ui-and-without-nabu-casa-alexa-media-player.yaml
    input:
      message: input_text.swa_alexa_text
      target: input_select.swa_alexa_device
- id: '1612096410696'
  alias: q3 Notify, wenn Waschmaschine fertig
  description: Waschmaschine fertig
  use_blueprint:
    path: Sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      finishing_hysteresis: 5
      power_sensor: sensor.shellys_wama_power
      starting_threshold: '100'
      starting_hysteresis: '3'
      finishing_threshold: '40'
      actions:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Waschmaschine ist fertig seit {{ now().hour }}:{{ now().minute
            }}.
      - service: script.turn_on
        data: {}
        entity_id: script.alexa_wama_fertig
- id: '1612602466906'
  alias: q3 Notify, wenn Katzentuer abends geschlossen
  description: ''
  trigger:
  - platform: state
    from: 'off'
    for: 00:05:00
    to: 'on'
    entity_id: binary_sensor.abend_eg_wohnzimmer_tuer_zu
  condition: []
  action:
  - service: script.alexa_doorbell
    data: {}
    entity_id: script.alexa_doorbell
  - service: script.alexa_tts_katzentur_offnen
    data: {}
    entity_id: script.alexa_tts_katzentur_offnen
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Die Wohnzimmertür für die Katzen offen lassen.
  mode: single
- id: '1612604258681'
  alias: q3 Notify, wenn  2000 Uhr und Volvo hat zu wenig Benzin
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: template
    value_template: '{{ states(''sensor.su_xp1654_fuel_amount'') | float < 10 }}'
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Der Volvo hat nur noch {{ states('sensor.su_xp1654_fuel_amount') }}l
        Benzin.
  mode: single
- id: '1612709996219'
  alias: q3 Notify, wenn Garage zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:30:00
    id: garage1
  - platform: state
    entity_id: binary_sensor.shelly1_garage_input
    to: 'off'
    for: 00:45:00
    id: garage2
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: garage1
        - condition: trigger
          id: garage2
      sequence:
      - service: script.notify_people_who_are_present
        data:
          title: Hinweis
          message: Garagentor ist (zu lange) offen
    default: []
  mode: single
- id: '1612710199273'
  alias: q3 Notify, wenn Haustür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.haustur
    to: 'on'
    for: 00:10:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Haustür ist (zu lange) offen. Es hat {{ state_attr('weather.home',
        'temperature') }} Grad draußen."
  mode: single
- id: '1612710265420'
  alias: q3 Notify, wenn Kellertür zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.kellertur
    to: 'on'
    for: 00:30:00
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Kellertür ist (zu lange) offen. Es hat {{ state_attr('weather.home',
        'temperature') }} Grad draußen."
  mode: single
- id: '1612710429192'
  alias: q3 Urgent Notify, wenn Freezer im Büro zu lange offen ist
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:02:00
  - platform: state
    entity_id: binary_sensor.eg_freezer
    to: 'on'
    for: 00:04:00
  condition: []
  action:
  - service: script.urgent_notify_people_who_are_present
    data:
      title: Hinweis
      message: Freezer im Büro ist (zu lange) offen.
  mode: single
- id: '1616954536097'
  alias: q3 Notify parents, wenn Luftfeuchtigkeit zu hoch
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_schlaf'') == ''on'' and
      states(''sensor.dew_og_schlaf_open_window'') }}'
    id: schlafzimmer
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_elternbad'') == ''on''
      and states(''sensor.dew_og_elternbad_open_window'') }}'
    id: elternbad
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_konstantin'')== ''on''
      and states(''sensor.dew_og_konstantin_open_window'') }}'
    id: konstantin
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_og_clara'') == ''on'' and
      states(''sensor.dew_og_clara_open_window'') }}'
    id: clara
  - platform: template
    value_template: '{{ states(''binary_sensor.humidity_eg_buro'') == ''on'' and states(''sensor.dew_eg_buro_open_window'')
      }}'
    id: Büro EG
  condition: []
  action:
  - service: script.notify_parents
    data:
      title: Hinweis
      message: '{{ trigger.to_state.attributes.friendly_name }} Bitte Fenster öffnen.'
  mode: queued
  max: 10
- id: '1620552474899'
  alias: Advanced Heating Reset offsets
  description: ''
  trigger:
  - platform: time
    at: '23:05'
  condition: []
  action:
  - service: script.heating_reset_offsets
  mode: single
- id: '1620553045155'
  alias: q3 Wenn zu warm im DG oder 0900 Uhr und Stefan im Office, frage Stefan ob
    AC angestellt werden soll
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.stefan_working_in_office
    to: 'on'
  - platform: time
    at: 09:00:00
  condition:
  - condition: template
    value_template: '{{states("sensor.multi_dg_stefan_temperature") | float >= 23}}'
  - condition: state
    entity_id: binary_sensor.stefan_working_in_office
    state: 'on'
  - condition: template
    value_template: '{{ is_state(''automation.notify_stefan_zu_heiss_in_dg'', ''off'')  }}'
  action:
  - alias: q1 Set up variables for the actions
    variables:
      action_on: '{{ ''ON_'' ~ context.id }}'
      action_nothing: '{{ ''NOTHING_'' ~ context.id }}'
  - alias: q1 Ask a question
    service: notify.mobile_app_swaiphone
    data:
      message: Temp too hot in office. Turn on AC?
      data:
        actions:
        - action: '{{ action_on }}'
          title: 'On'
        - action: '{{ action_nothing }}'
          title: No thanks
  - alias: q1 Wait for a response
    wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_on }}'
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: '{{ action_nothing }}'
  - alias: q1 Perform the action
    choose:
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_on}}'
      sequence:
      - service: script.turn_on_ac_at_stefans_office
    - conditions:
      - condition: template
        value_template: '{{ wait.trigger.event.data.action == action_nothing }}'
      sequence:
  mode: single
  max: 10
- id: '1623348230796'
  alias: q3 Wenn Nacht, dann lasse Pool Pumpe laufen
  description: ''
  trigger:
  - platform: time
    at: '23:00'
  condition: []
  action:
  - type: turn_on
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  - delay:
      hours: 4
      minutes: 0
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 0890c146d5a406d9af64dcbe0662bd4e
    entity_id: switch.shellys_poolpump
    domain: switch
  mode: single
- id: '1626027211313'
  alias: 'q3 Notify Stefan, wenn major shelly und esp devices nicht verfügbar sind '
  description: ''
  use_blueprint:
    path: bfranke1973/device_connectivity_notification.yaml
    input:
      message: ' Hint: network connection lost for devices: {{ disconnected_servers
        }} '
      notify_device: 20e9e482dc45d545dcb6222c8f32454a
      server_group: group.servers
- id: '1629920509114'
  alias: Advanced Basement Fan control
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.dew_runfan
    from: 'False'
    to: 'True'
    id: runfantrue
  - platform: homeassistant
    event: start
    id: homestart
  - platform: state
    entity_id: sensor.dew_runfan
    id: runfanfalse
    from: 'True'
    to: 'False'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: runfantrue
        - condition: trigger
          id: homestart
      - condition: template
        value_template: '{{ is_state(''script.dehumidify_basement'', ''off'')  }}'
      sequence:
      - service: script.dehumidify_basement
    - conditions:
      - condition: trigger
        id: runfanfalse
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellys_keller_luefter1
    default: []
  mode: single
- id: '1630823090164'
  alias: Advanced Heating HC1
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.heating_hc1_trigger
    to: too-cold
    id: hc1-too-cold
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc1_trigger
    to: too-warm
    id: hc1-too-warm
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc1_trigger
    id: hc1-back-ok
    for: 00:20:00
    to: ok
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: hc1-too-cold
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":+3, "id":1}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc1-too-warm
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":-3, "id":1}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc1-back-ok
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":0, "id":1}'
          qos: '1'
    default: []
  mode: queued
  max: 10
- id: '1630829101033'
  alias: Advanced Heating (Backup)
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.swatest
    to: 'on'
    id: hc1-back-to-on
  - platform: state
    entity_id: input_boolean.swatest
    to: 'off'
    id: hc1-back-to-off
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: hc1-back-to-on
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating 1
          message: '2on {{ trigger.from_state.state }} to {{ trigger.to_state.state
            }} This was triggered by {{ trigger.id }}

            '
    - conditions:
      - condition: trigger
        id: hc1-back-to-off
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating 2
          message: '2off {{ trigger.from_state.state }} to {{ trigger.to_state.state
            }} This was triggered by {{ trigger.id }}

            '
    default: []
  mode: queued
  max: 10
- id: '1630830548440'
  alias: Advanced Heating HC2
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.heating_hc2_trigger
    to: too-cold
    id: hc2-too-cold
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc2_trigger
    to: too-warm
    id: hc2-too-warm
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc2_trigger
    id: hc2-back-ok
    for: 00:20:00
    to: ok
  - platform: state
    entity_id: sensor.heating_hc2vshc1_trigger
    id: hc2-hc1-back-ok
    for: 00:20:00
    to: ok
  - platform: state
    entity_id: sensor.heating_hc2vshc1_trigger
    id: hc2-hc1-too-warm
    for: 00:20:00
    to: too-wam
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: hc2-too-cold
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":+3, "id":2}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc2-too-warm
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":-3, "id":2}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc2-back-ok
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":0, "id":2}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc2-hc1-back-ok
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":0, "id":2}'
          qos: '1'
      - service: system_log.write
        data:
          level: info
          logger: swa-log
          message: Hearting Triggered by {{ trigger.id }}
    - conditions:
      - condition: trigger
        id: hc2-hc1-too-warm
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":-3, "id":2}'
          qos: '1'
      - service: system_log.write
        data:
          level: info
          logger: swa-log
          message: Hearting Triggered by {{ trigger.id }}
    default: []
  mode: queued
  max: 10
- id: '1630830589458'
  alias: Advanced Heating HC3
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.heating_hc3_trigger
    to: too-cold
    id: hc3-too-cold
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc3_trigger
    to: too-warm
    id: hc3-too-warm
    for: 00:20:00
  - platform: state
    entity_id: sensor.heating_hc3_trigger
    id: hc3-back-ok
    for: 00:20:00
    to: ok
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: hc3-too-cold
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":+3, "id":3}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc3-too-warm
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":-3, "id":3}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: hc3-back-ok
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":0, "id":3}'
          qos: '1'
    default: []
  mode: queued
  max: 10
- id: '1630838302181'
  alias: Advanced Heating Forecast
  description: ''
  trigger:
  - platform: time
    at: '23:30'
  condition: []
  action:
  - service: input_text.set_value
    target:
      entity_id: input_text.heating_forecast_condition
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].condition }}'
  - service: input_number.set_value
    target:
      entity_id: input_number.heating_forecast_temperature
    data:
      value: '{{ state_attr(''weather.home'', ''forecast'')[0].temperature | float
        }}'
  - condition: state
    entity_id: sensor.heating_warmnextday
    state: warm
  - service: mqtt.publish
    data:
      topic: ems-esp/thermostat
      payload: '{"cmd":"offsettemp","data":-3, "id":1}'
      qos: '1'
  - service: mqtt.publish
    data:
      topic: ems-esp/thermostat
      payload: '{"cmd":"offsettemp","data":-3, "id":2}'
      qos: '1'
  - service: mqtt.publish
    data:
      topic: ems-esp/thermostat
      payload: '{"cmd":"offsettemp","data":-3, "id":3}'
      qos: '1'
  - service: system_log.write
    data:
      level: info
      logger: swa-log
      message: Tomorrow will be warm ({{states('input_text.heating_forecast_condition')}}/
        {{states('input_number.heating_forecast_temperature')}}). All offsets -3.
        If temp at night below 17, heating will likely still be off.
  mode: single
- id: '1630944728318'
  alias: Advanced Rolladen Clara
  description: Rolladensteuerung Clara zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: time
    at: 07:05
    id: morgens-wochentag
  - platform: time
    at: 08:30
    id: morgens-wochenende
  - platform: time
    id: abends
    at: '19:45'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morgens-wochentag
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      sequence:
      - service: cover.set_cover_position
        data:
          position: 100
        target:
          entity_id: cover.shelly25_og_clara
    - conditions:
      - condition: trigger
        id: morgens-wochenende
      - condition: time
        weekday:
        - sat
        - sun
      sequence:
      - service: cover.set_cover_position
        data:
          position: 100
        target:
          entity_id: cover.shelly25_og_clara
    - conditions:
      - condition: trigger
        id: abends
      sequence:
      - service: cover.set_cover_position
        target:
          entity_id: cover.shelly25_og_clara
        data:
          position: 5
    default: []
  mode: single
- id: '1631904142960'
  alias: Advanced Heating Monitor
  description: Sends message to Stefan if heating shows non-regular codes,  keeps
    HC2 target temp below HC1, sets NTP time at night
  trigger:
  - platform: state
    entity_id: sensor.boiler_service_code
    to: 6A
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    id: servicecode
  - platform: template
    value_template: '{{ states(''sensor.heating_hc2_delta'')|float > 0.0 }}'
    id: hc2ghc1
  - platform: time
    at: 00:01
    id: setntp
  - platform: numeric_state
    entity_id: sensor.boiler_system_pressure
    below: '1.9'
    id: heizungsdruck
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: servicecode
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating
          message: 'Service Code: {{ states(''sensor.boiler_service_code'') }} Service
            Code Number: {{ states(''sensor.boiler_service_code_number'') }}'
    - conditions:
      - condition: trigger
        id: hc2ghc1
      sequence:
      - service: system_log.write
        data:
          message: HC2 greater HC1, delta is {{ states('sensor.heating_hc2_delta')|float
            }}, sending offset {{[-(states('sensor.heating_hc2_delta')|float/3)|round(0,"floor"),-3]|max
            }}
          level: info
          logger: swa-log
      - service: mqtt.publish
        data:
          qos: '1'
          topic: ems-esp/thermostat
          payload: '{"cmd":"offsettemp","data":{{[-(states(''sensor.heating_hc2_delta'')|float/3)|round(0,"floor"),-3]|max
            }},"id":2}'
      - delay:
          hours: 0
          minutes: 10
          seconds: 0
          milliseconds: 0
      - condition: template
        value_template: '{{ states(''sensor.heating_hc2_delta'')|float > 0.0 and states(''sensor.thermostat_hc2_offset_temperature'')
          != ''-3'' }}'
      - service: script.notify_stefan_heating
        data:
          title: Heating
          message: HC2 target temp still higher than HC1 target temp. Check heating.
    - conditions:
      - condition: trigger
        id: setntp
      sequence:
      - service: mqtt.publish
        data:
          topic: ems-esp/thermostat
          payload: '{"cmd":"datetime","data":"ntp"}'
          qos: '1'
    - conditions:
      - condition: trigger
        id: heizungsdruck
      sequence:
      - service: script.notify_stefan_heating
        data:
          title: Heating
          message: Heizungsdruck über 1h unter 1.9 bar.
  mode: single
- id: '1632044962572'
  alias: Send a camera snapshot when doorbell was activated
  description: ''
  use_blueprint:
    path: aceindy/send-camera-snapshot-notification-on-doorbell.yaml
    input:
      notification_message: '{{ binary_sensor_name }} was activated!'
      binary_sensor: input_boolean.swatest
      camera: camera.livingroom_profile000_mainstream
      notify_device: 20e9e482dc45d545dcb6222c8f32454a
      is_ios: true
      notification_title: The Doorbell was activated!
      delay: 1
- id: '1632288672635'
  alias: Advanced Basement Dehumidifier
  description: Run dehumidifier for 6h if humidity exceeds 58%
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.multi_keller_wasch_humidity'') | float > 58
      }}'
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.shellys_keller_entfeuchter
  - delay:
      hours: 6
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: switch.turn_off
    target:
      entity_id: switch.shellys_keller_entfeuchter
  mode: single
- id: '1632424762898'
  alias: Advanced Rolladen Schlafzimmer
  description: Rolladensteuerung Schlafzimmer zeitgesteuert Wochentags/Wochenende
  trigger:
  - platform: time
    at: input_datetime.cover_morning_weekday
    id: wochentags
  - platform: time
    at: input_datetime.cover_morning_holiday
    id: wochentagsferien
  - platform: sun
    event: sunset
    offset: 00:30:00
    id: abends1
  - platform: time
    at: '21:00'
    id: abends2
  - platform: time
    at: input_datetime.cover_morning_weekend
    id: wochenende
  - platform: numeric_state
    entity_id: sensor.multi_og_schlaf_temperature
    id: warmesschlafzimmer
    above: '23'
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends1
        - condition: trigger
          id: abends2
      sequence:
      - scene: scene.schlafzimmer_abend_sommer
    - conditions:
      - condition: trigger
        id: wochentags
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: input_boolean.ferien
        state: 'off'
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: wochentags
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: state
        entity_id: input_boolean.ferien
        state: 'on'
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: wochenende
      - condition: time
        weekday:
        - sat
        - sun
      sequence:
      - scene: scene.schlafzimmer_morgen
    - conditions:
      - condition: trigger
        id: warmesschlafzimmer
      - condition: state
        entity_id: weather.accuweather
        state: sunny
        for:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0
      - condition: time
        after: 09:00
      sequence:
      - service: cover.set_cover_position
        target:
          area_id:
          - og_schlaf
          - og_elternbad
          - og_clara
        data:
          position: 40
    default: []
  mode: single
- id: '1632469853125'
  alias: Advanced Rolladen Anna
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.multi_dg_anna_temperature
    above: '22'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - platform: time
    at: '10:01'
  condition:
  - condition: time
    after: '10:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: state
    entity_id: weather.accuweather
    state: sunny
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - condition: numeric_state
    entity_id: sensor.multi_dg_anna_temperature
    above: '22'
  action:
  - service: cover.close_cover
    target:
      entity_id: cover.shelly25_dg_anna_rolladen
  mode: single
- id: '1632479086952'
  alias: Power Save bei Stefan
  description: ''
  trigger:
  - platform: time
    at: 07:15
    id: morgens
  - platform: time
    at: '20:00'
    id: abends20
  - platform: time
    id: abends22
    at: '22:00'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: abends20
        - condition: trigger
          id: abends22
      - condition: state
        entity_id: binary_sensor.stefan_working_in_office
        state: 'off'
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
    - conditions:
      - condition: trigger
        id: morgens
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        after: 07:15
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.shellyp_dg_stefan_tisch
    default: []
  mode: single
- id: '1632543105220'
  alias: Power Save bei Waschmaschine
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.shellys_wama_power
    below: '3'
    above: '0'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch an.
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: numeric_state
    entity_id: sensor.shellys_wama_power
    above: '0'
    below: '3'
  - service: script.notify_people_who_are_present
    data:
      title: Hinweis
      message: Waschmaschine ist noch immer an.
  mode: single
- id: '1632671280558'
  alias: Advanced Monitor Stefan
  description: ''
  trigger:
  - platform: time
    at: '21:00'
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: heat_cool
    - condition: device
      device_id: 5bf5071ab5a3fc16e59cf627ced76b85
      domain: climate
      entity_id: climate.roofac
      type: is_hvac_mode
      hvac_mode: cool
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.fenster_sw
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
    - condition: state
      entity_id: binary_sensor.fenster_o
      state: 'on'
      for:
        hours: 0
        minutes: 11
        seconds: 0
        milliseconds: 0
  action:
  - service: script.notify_stefan
    data:
      title: Hinweis
      message: Klimaanlage im DG läuft noch.
  mode: single
- id: '1633005819799'
  alias: Avanced Heating, workdays
  description: ''
  trigger:
  - platform: time
    at: 07:00
    id: morning
  - platform: time
    id: noon
    at: '12:00'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning
      - condition: time
        weekday:
        - mon
        - thu
        - fri
      sequence:
      - service: script.heating_set_room_temp_low
      - service: system_log.write
        data:
          level: critical
          logger: swa-log
          message: Started script.heating_set_room_temp_low
    - conditions:
      - condition: trigger
        id: noon
      - condition: time
        weekday:
        - mon
        - thu
        - fri
      sequence:
      - service: script.heating_set_room_temp_high
      - service: system_log.write
        data:
          level: critical
          logger: swa-log
          message: Started script.heating_set_room_temp_high
    default: []
  mode: single
